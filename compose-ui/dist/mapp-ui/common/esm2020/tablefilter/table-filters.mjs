import { DateTime, Interval } from 'luxon';
const filterCollection = {
    substringMatch: (filterTerm, dataVal) => {
        if (filterTerm && dataVal) {
            return dataVal.toLowerCase().includes(filterTerm.toLowerCase());
        }
        else {
            return !(filterTerm && !dataVal);
        }
    },
    exactMatch: (filterTerm, dataVal) => {
        if (filterTerm && dataVal) {
            if (typeof dataVal === 'string') {
                return dataVal.toLowerCase() === filterTerm.toLowerCase();
            }
            else {
                return +filterTerm === dataVal;
            }
        }
        else {
            return !(filterTerm && !dataVal);
        }
    },
    dateMatch: (filterTerm, dataVal) => {
        if (filterTerm && dataVal) {
            if (typeof dataVal === 'string') {
                return DateTime.fromISO(filterTerm).hasSame(DateTime.fromISO(dataVal), 'day');
            }
            else {
                return DateTime.fromISO(filterTerm).hasSame(DateTime.fromMillis(dataVal), 'day');
            }
        }
        else {
            return !(filterTerm && !dataVal);
        }
    },
    dateRangeMatch: (filterTerm, dataVal) => {
        if (!filterTerm || !dataVal) {
            return !(filterTerm && !dataVal);
        }
        const dr = Interval.fromISO(filterTerm);
        if (!dr.start || !dr.end) {
            return !(filterTerm && !dataVal);
        }
        // create adjusted interval with +1 day end, as end date is exclusive in the interval
        const dateRange = Interval.fromDateTimes(dr.start, dr.end.plus({ days: 1 }));
        const dt = typeof dataVal === 'string' ? DateTime.fromISO(dataVal) : DateTime.fromMillis(dataVal);
        return dateRange.contains(dt);
    },
    propertyMatch: (filterTerm, data, paths) => {
        let combinedVal = '';
        // search json value by path for example "owner.firstName"
        const resolveJsonPropValue = (path, obj) => {
            return path.split('.').reduce((prev, current) => {
                return prev ? prev[current] : null;
            }, obj || self);
        };
        paths?.forEach(path => {
            const resolvedVal = resolveJsonPropValue(path, data);
            if (resolvedVal) {
                combinedVal += resolvedVal + ' ';
            }
        });
        if (filterTerm && combinedVal) {
            return combinedVal.toLowerCase().includes(filterTerm.toLowerCase());
        }
        else {
            return !(filterTerm && !combinedVal);
        }
    }
};
/**
 * Registers a filterPredicate function on the MatTableDataSource, configured by the given filtersConfig
 * @param filtersConfig filter configuration to be used for this table
 * @param dataSource the data source where the filters should be applied
 */
export function setUpFilterPredicate(filtersConfig, dataSource) {
    dataSource.filterPredicate = (data, filterString) => {
        const filters = JSON.parse(filterString);
        const filterResult = Object.keys(filters).map(key => {
            const filterTerm = filters[key];
            const dataValue = data[key];
            const currentFilter = filterCollection[filtersConfig[key].matcher];
            const currentPaths = filtersConfig[key].paths;
            if (currentFilter) {
                if (currentPaths) {
                    return currentFilter(filterTerm, data, currentPaths);
                }
                else {
                    return currentFilter(filterTerm, dataValue);
                }
            }
            else {
                return true;
            }
        });
        const result = filterResult.reduce((prev, curr) => prev && curr);
        return result;
    };
}
/**
 * Default implementation for the sortingDataAccessor to be passed to a MatTableDataSource.
 * All data values are expected to be of type string | number | boolean.
 * If your table data has different value types, use a custom implementation for sortingDataAccessor.
 */
export function defaultSortingDataAccessor(data, sortHeaderId) {
    const sortValue = data[sortHeaderId];
    if (typeof sortValue === 'string') {
        return sortValue.toLowerCase();
    }
    else if (typeof sortValue === 'boolean') {
        return sortValue ? 1 : 0;
    }
    else {
        return sortValue;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUtZmlsdGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hcHAtdWkvY29tbW9uL3RhYmxlZmlsdGVyL3NyYy90YWJsZS1maWx0ZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBMkIzQyxNQUFNLGdCQUFnQixHQUFxQjtJQUN6QyxjQUFjLEVBQUUsQ0FBQyxVQUFrQixFQUFFLE9BQWUsRUFBRSxFQUFFO1FBQ3RELElBQUksVUFBVSxJQUFJLE9BQU8sRUFBRTtZQUN6QixPQUFPLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7U0FDakU7YUFBTTtZQUNMLE9BQU8sQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztJQUNELFVBQVUsRUFBRSxDQUFDLFVBQWtCLEVBQUUsT0FBd0IsRUFBRSxFQUFFO1FBQzNELElBQUksVUFBVSxJQUFJLE9BQU8sRUFBRTtZQUN6QixJQUFJLE9BQU8sT0FBTyxLQUFLLFFBQVEsRUFBRTtnQkFDL0IsT0FBTyxPQUFPLENBQUMsV0FBVyxFQUFFLEtBQUssVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQzNEO2lCQUFNO2dCQUNMLE9BQU8sQ0FBQyxVQUFVLEtBQUssT0FBTyxDQUFDO2FBQ2hDO1NBQ0Y7YUFBTTtZQUNMLE9BQU8sQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztJQUNELFNBQVMsRUFBRSxDQUFDLFVBQWtCLEVBQUUsT0FBd0IsRUFBRSxFQUFFO1FBQzFELElBQUksVUFBVSxJQUFJLE9BQU8sRUFBRTtZQUN6QixJQUFJLE9BQU8sT0FBTyxLQUFLLFFBQVEsRUFBRTtnQkFDL0IsT0FB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QUMsV0FBVyxFQUFFLENBQUM7S0FDaEM7U0FBTSxJQUFJLE9BQU8sU0FBUyxLQUFLLFNBQVMsRUFBRTtRQUN6QyxPQUFPLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDMUI7U0FBTTtRQUNMLE9BQU8sU0FBUyxDQUFDO0tBQ2xCO0FBRUgsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1hdFRhYmxlRGF0YVNvdXJjZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3RhYmxlJztcclxuaW1wb3J0IHsgRGF0ZVRpbWUsIEludGVydmFsIH0gZnJvbSAnbHV4b24nO1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgZmlsZSBob2xkcyBoZWxwZXJzIGZvciBjcmVhdGluZyBmaWx0ZXJzIGZvciBtYXRlcmlhbCBkYXRhIHRhYmxlXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIENvbmZpZ3VyYXRpb24gcGFyYW1ldGVycyBmb3IgYSBnaXZlbiBmaWx0ZXIgaW5zdGFuY2UuIFVzZSBhcyBmb2xsb3dzOlxyXG4gKiBuYW1lOiBuYW1lIG9mIHRoZSBjb2x1bW4gdG8gYmUgZmlsdGVyZWQuIG5lZWRzIHRvIG1hdGNoIHRoZSBjb2x1bW4gbmFtZSB1c2VkIGluIE1hdFRhYmxlRGF0YVNvdXJjZVxyXG4gKiBtYXRjaGVyOiB0aGUgbWF0Y2hlciB0byBiZSB1c2VkIGZvciBmaWx0ZXJpbmcuIEN1cnJlbnRseSBzdXBwb3J0ZWRcclxuICogICAtIHN1YnN0cmluZ01hdGNoOiBtYXRjaCBvbiBhIHN1YnN0cmluZyBsZXZlbFxyXG4gKiAgIC0gZXhhY3RNYXRjaDogZXhhY3QgbWF0Y2gsIHN1cHBvcnRzIHN0cmluZyBhbmQgbnVtYmVyc1xyXG4gKiAgIC0gZGF0ZU1hdGNoOiBtYXRjaCBkYXRlcyBvbiBhIGRheS1iYXNlZCBncmFudWxhcml0eSAodGltZSBpcyBpZ25vcmVkKVxyXG4gKiAgIC0gZGF0ZVJhbmdlTWF0Y2g6IG1hdGNoIGFnYWluc3QgYSBkYXRlIHJhbmdlXHJcbiAqICAgLSBwcm9wZXJ0eU1hdGNoOiBtYXRjaGluZyBmb3IgbmVzdGVkIG9iamVjdCBzdHJ1Y3R1cmVzXHJcbiAqIHBhdGhzOiB0aGlzIGlzIHVzZWQgYnkgcHJvcGVydHlNYXRjaC4gc3BlY2lmeSB0aGUgbG9va3VwIHBhdGggb2Ygb25lIG9yIG11bHRpcGxlIHByb3BlcnRpZXMgdG8gZmlsdGVyXHJcbiAqIEV4YW1wbGU6IHBhdGhzOiBbJ293bmVyLmZpcnN0TmFtZScsICdvd25lci5sYXN0TmFtZSddXHJcbiAqIGZvciBhcnJheXMgc3BlY2lmeSB0aGUgaW5kZXggcG9zaXRpb24gYWxzbyBpbiBkb3Qgbm90YXRpb246IHBhdGhzOiBbJ2V2ZW50cy4wLnR5cGUnXVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBGaWx0ZXJDb25maWcge1xyXG4gIFtuYW1lOiBzdHJpbmddOiB7IG1hdGNoZXI6IHN0cmluZywgcGF0aHM/OiBzdHJpbmdbXSB9O1xyXG59XHJcblxyXG5pbnRlcmZhY2UgRmlsdGVyQ29sbGVjdGlvbiB7XHJcbiAgW25hbWU6IHN0cmluZ106IChmaWx0ZXJUZXJtOiBzdHJpbmcsIGRhdGFWYWw6IGFueSwgcGF0aHM/OiBzdHJpbmdbXSkgPT4gYm9vbGVhbjtcclxufVxyXG5cclxuY29uc3QgZmlsdGVyQ29sbGVjdGlvbjogRmlsdGVyQ29sbGVjdGlvbiA9IHtcclxuICBzdWJzdHJpbmdNYXRjaDogKGZpbHRlclRlcm06IHN0cmluZywgZGF0YVZhbDogc3RyaW5nKSA9PiB7XHJcbiAgICBpZiAoZmlsdGVyVGVybSAmJiBkYXRhVmFsKSB7XHJcbiAgICAgIHJldHVybiBkYXRhVmFsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyVGVybS50b0xvd2VyQ2FzZSgpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAhKGZpbHRlclRlcm0gJiYgIWRhdGFWYWwpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgZXhhY3RNYXRjaDogKGZpbHRlclRlcm06IHN0cmluZywgZGF0YVZhbDogc3RyaW5nIHwgbnVtYmVyKSA9PiB7XHJcbiAgICBpZiAoZmlsdGVyVGVybSAmJiBkYXRhVmFsKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgZGF0YVZhbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICByZXR1cm4gZGF0YVZhbC50b0xvd2VyQ2FzZSgpID09PSBmaWx0ZXJUZXJtLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuICtmaWx0ZXJUZXJtID09PSBkYXRhVmFsO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gIShmaWx0ZXJUZXJtICYmICFkYXRhVmFsKTtcclxuICAgIH1cclxuICB9LFxyXG4gIGRhdGVNYXRjaDogKGZpbHRlclRlcm06IHN0cmluZywgZGF0YVZhbDogc3RyaW5nIHwgbnVtYmVyKSA9PiB7XHJcbiAgICBpZiAoZmlsdGVyVGVybSAmJiBkYXRhVmFsKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgZGF0YVZhbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICByZXR1cm4gRGF0ZVRpbWUuZnJvbUlTTyhmaWx0ZXJUZXJtKS5oYXNTYW1lKERhdGVUaW1lLmZyb21JU08oZGF0YVZhbCksICdkYXknKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gRGF0ZVRpbWUuZnJvbUlTTyhmaWx0ZXJUZXJtKS5oYXNTYW1lKERhdGVUaW1lLmZyb21NaWxsaXMoZGF0YVZhbCksICdkYXknKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAhKGZpbHRlclRlcm0gJiYgIWRhdGFWYWwpO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGRhdGVSYW5nZU1hdGNoOiAoXHJcbiAgICAgIGZpbHRlclRlcm06IHN0cmluZyxcclxuICAgICAgZGF0YVZhbDogc3RyaW5nIHwgbnVtYmVyKTogYm9vbGVhbiA9PiB7XHJcbiAgICBpZiAoIWZpbHRlclRlcm0gfHwgIWRhdGFWYWwpIHtcclxuICAgICAgcmV0dXJuICEoZmlsdGVyVGVybSAmJiAhZGF0YVZhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZHIgPSBJbnRlcnZhbC5mcm9tSVNPKGZpbHRlclRlcm0pO1xyXG4gICAgaWYgKCFkci5zdGFydCB8fCAhZHIuZW5kKSB7XHJcbiAgICAgIHJldHVybiAhKGZpbHRlclRlcm0gJiYgIWRhdGFWYWwpO1xyXG4gICAgfVxyXG4gICAgLy8gY3JlYXRlIGFkanVzdGVkIGludGVydmFsIHdpdGggKzEgZGF5IGVuZCwgYXMgZW5kIGRhdGUgaXMgZXhjbHVzaXZlIGluIHRoZSBpbnRlcnZhbFxyXG4gICAgY29uc3QgZGF0ZVJhbmdlID0gSW50ZXJ2YWwuZnJvbURhdGVUaW1lcyhkci5zdGFydCwgZHIuZW5kLnBsdXMoeyBkYXlzOiAxIH0pKTtcclxuICAgIGNvbnN0IGR0ID0gdHlwZW9mIGRhdGFWYWwgPT09ICdzdHJpbmcnID8gRGF0ZVRpbWUuZnJvbUlTTyhkYXRhVmFsKSA6IERhdGVUaW1lLmZyb21NaWxsaXMoZGF0YVZhbCk7XHJcbiAgICByZXR1cm4gZGF0ZVJhbmdlLmNvbnRhaW5zKGR0KTtcclxuICB9LFxyXG5cclxuICBwcm9wZXJ0eU1hdGNoOiAoXHJcbiAgICAgIGZpbHRlclRlcm06IHN0cmluZyxcclxuICAgICAgZGF0YTogYW55LFxyXG4gICAgICBwYXRocz86IHN0cmluZ1tdKSA9PiB7XHJcbiAgICBsZXQgY29tYmluZWRWYWwgPSAnJztcclxuXHJcbiAgICAvLyBzZWFyY2gganNvbiB2YWx1ZSBieSBwYXRoIGZvciBleGFtcGxlIFwib3duZXIuZmlyc3ROYW1lXCJcclxuICAgIGNvbnN0IHJlc29sdmVKc29uUHJvcFZhbHVlID0gKHBhdGg6IHN0cmluZywgb2JqOiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIHBhdGguc3BsaXQoJy4nKS5yZWR1Y2UoKHByZXYsIGN1cnJlbnQpID0+IHtcclxuICAgICAgICByZXR1cm4gcHJldiA/IHByZXZbY3VycmVudF0gOiBudWxsO1xyXG4gICAgICB9LCBvYmogfHwgc2VsZik7XHJcbiAgICB9O1xyXG5cclxuICAgIHBhdGhzPy5mb3JFYWNoKHBhdGggPT4ge1xyXG4gICAgICBjb25zdCByZXNvbHZlZFZhbCA9IHJlc29sdmVKc29uUHJvcFZhbHVlKHBhdGgsIGRhdGEpO1xyXG4gICAgICBpZiAocmVzb2x2ZWRWYWwpIHtcclxuICAgICAgICBjb21iaW5lZFZhbCArPSByZXNvbHZlZFZhbCArICcgJztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGZpbHRlclRlcm0gJiYgY29tYmluZWRWYWwpIHtcclxuICAgICAgcmV0dXJuIGNvbWJpbmVkVmFsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyVGVybS50b0xvd2VyQ2FzZSgpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAhKGZpbHRlclRlcm0gJiYgIWNvbWJpbmVkVmFsKTtcclxuICAgIH1cclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogUmVnaXN0ZXJzIGEgZmlsdGVyUHJlZGljYXRlIGZ1bmN0aW9uIG9uIHRoZSBNYXRUYWJsZURhdGFTb3VyY2UsIGNvbmZpZ3VyZWQgYnkgdGhlIGdpdmVuIGZpbHRlcnNDb25maWdcclxuICogQHBhcmFtIGZpbHRlcnNDb25maWcgZmlsdGVyIGNvbmZpZ3VyYXRpb24gdG8gYmUgdXNlZCBmb3IgdGhpcyB0YWJsZVxyXG4gKiBAcGFyYW0gZGF0YVNvdXJjZSB0aGUgZGF0YSBzb3VyY2Ugd2hlcmUgdGhlIGZpbHRlcnMgc2hvdWxkIGJlIGFwcGxpZWRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXRVcEZpbHRlclByZWRpY2F0ZShmaWx0ZXJzQ29uZmlnOiBGaWx0ZXJDb25maWcsIGRhdGFTb3VyY2U6IE1hdFRhYmxlRGF0YVNvdXJjZTxhbnk+KTogdm9pZCB7XHJcblxyXG4gIGRhdGFTb3VyY2UuZmlsdGVyUHJlZGljYXRlID0gKGRhdGEsIGZpbHRlclN0cmluZykgPT4ge1xyXG4gICAgY29uc3QgZmlsdGVycyA9IEpTT04ucGFyc2UoZmlsdGVyU3RyaW5nKTtcclxuXHJcbiAgICBjb25zdCBmaWx0ZXJSZXN1bHQgPSBPYmplY3Qua2V5cyhmaWx0ZXJzKS5tYXAoa2V5ID0+IHtcclxuICAgICAgY29uc3QgZmlsdGVyVGVybSA9IGZpbHRlcnNba2V5XTtcclxuICAgICAgY29uc3QgZGF0YVZhbHVlOiBzdHJpbmcgPSBkYXRhW2tleV07XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRGaWx0ZXIgPSBmaWx0ZXJDb2xsZWN0aW9uW2ZpbHRlcnNDb25maWdba2V5XS5tYXRjaGVyXTtcclxuICAgICAgY29uc3QgY3VycmVudFBhdGhzID0gZmlsdGVyc0NvbmZpZ1trZXldLnBhdGhzO1xyXG5cclxuICAgICAgaWYgKGN1cnJlbnRGaWx0ZXIpIHtcclxuICAgICAgICBpZiAoY3VycmVudFBhdGhzKSB7XHJcbiAgICAgICAgICByZXR1cm4gY3VycmVudEZpbHRlcihmaWx0ZXJUZXJtLCBkYXRhLCBjdXJyZW50UGF0aHMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gY3VycmVudEZpbHRlcihmaWx0ZXJUZXJtLCBkYXRhVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGZpbHRlclJlc3VsdC5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IHByZXYgJiYgY3Vycik7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH07XHJcblxyXG59XHJcblxyXG50eXBlIFRhYmxlRGF0YVZhbHVlID0gc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbjtcclxudHlwZSBUYWJsZURhdGEgPSBSZWNvcmQ8c3RyaW5nLCBUYWJsZURhdGFWYWx1ZT47XHJcblxyXG4vKipcclxuICogRGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBmb3IgdGhlIHNvcnRpbmdEYXRhQWNjZXNzb3IgdG8gYmUgcGFzc2VkIHRvIGEgTWF0VGFibGVEYXRhU291cmNlLlxyXG4gKiBBbGwgZGF0YSB2YWx1ZXMgYXJlIGV4cGVjdGVkIHRvIGJlIG9mIHR5cGUgc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbi5cclxuICogSWYgeW91ciB0YWJsZSBkYXRhIGhhcyBkaWZmZXJlbnQgdmFsdWUgdHlwZXMsIHVzZSBhIGN1c3RvbSBpbXBsZW1lbnRhdGlvbiBmb3Igc29ydGluZ0RhdGFBY2Nlc3Nvci5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWZhdWx0U29ydGluZ0RhdGFBY2Nlc3NvcjxUPihcclxuICAgIGRhdGE6IFQsXHJcbiAgICBzb3J0SGVhZGVySWQ6IHN0cmluZyk6IHN0cmluZyB8IG51bWJlciB7XHJcbiAgY29uc3Qgc29ydFZhbHVlID0gKGRhdGEgYXMgVGFibGVEYXRhKVtzb3J0SGVhZGVySWRdO1xyXG4gIGlmICh0eXBlb2Ygc29ydFZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgcmV0dXJuIHNvcnRWYWx1ZS50b0xvd2VyQ2FzZSgpO1xyXG4gIH0gZWxzZSBpZiAodHlwZW9mIHNvcnRWYWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICByZXR1cm4gc29ydFZhbHVlID8gMSA6IDA7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBzb3J0VmFsdWU7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=