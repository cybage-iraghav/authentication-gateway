import { HttpParams } from '@angular/common/http';
import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { Validators } from '@angular/forms';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common/http";
import * as i3 from "@mapp-ui/notification-center";
import * as i4 from "@angular/platform-browser";
import * as i5 from "@angular/common";
import * as i6 from "@angular/material/button";
import * as i7 from "@angular/material/input";
import * as i8 from "@angular/material/form-field";
export class EditPasswordComponent {
    constructor(fb, http, nc, sanitizer, cd) {
        this.fb = fb;
        this.http = http;
        this.nc = nc;
        this.sanitizer = sanitizer;
        this.cd = cd;
        this.oldPasswordRequired = false;
    }
    get newPassword() {
        return this.form.get('new_psw');
    }
    get newPasswordConfirm() {
        return this.form.get('new_psw_confirm');
    }
    ngOnInit() {
        this.form = this.fb.group({
            new_psw: ['', Validators.required],
            new_psw_confirm: ['', Validators.required]
        }, {
            validators: control => {
                const psw = control.get('new_psw')?.value;
                const pswConfirm = control.get('new_psw_confirm');
                const pswConfirmVal = pswConfirm?.value;
                if (pswConfirmVal.length > 0 && pswConfirmVal !== psw) {
                    const passwordMatchError = { noPasswordMatch: true };
                    pswConfirm?.setErrors(passwordMatchError);
                    return passwordMatchError;
                }
                else {
                    return null;
                }
            }
        });
        if (this.oldPasswordRequired) {
            this.form.addControl('psw', this.fb.control('', Validators.required));
        }
    }
    updatePassword() {
        if (this.form.valid) {
            const data = this.form.value;
            data.suid = this.userId;
            data.action = 'changeSystemUserPassword';
            data.errorPage = '/inc/ecError.jsp';
            const body = new HttpParams({ fromObject: data });
            const responseHandler = (res) => {
                if (res.indexOf('ec-errors') > -1) {
                    this.errorMessage = this.sanitizer.bypassSecurityTrustHtml(res);
                }
                else {
                    this.nc.addNotification({
                        type: 'SUCCESS',
                        message: {
                            headline: 'Password updated successfully.'
                        }
                    });
                    this.errorMessage = null;
                }
                this.cd.markForCheck();
            };
            if (this.updatePasswordUrl) {
                this.http.post(this.updatePasswordUrl, body, { responseType: 'text' })
                    .subscribe({
                    next: responseHandler,
                    error: (err) => {
                        this.nc.addNotification({
                            type: 'ERROR',
                            message: {
                                headline: 'Password update failed.',
                                body: err.message
                            }
                        });
                    }
                });
            }
        }
    }
}
EditPasswordComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EditPasswordComponent, deps: [{ token: i1.UntypedFormBuilder }, { token: i2.HttpClient }, { token: i3.NotificationService }, { token: i4.DomSanitizer }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
EditPasswordComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: EditPasswordComponent, selector: "mui-edit-password", inputs: { userId: "userId", updatePasswordUrl: "updatePasswordUrl", oldPasswordRequired: "oldPasswordRequired" }, ngImport: i0, template: "<section class=\"form-container\">\r\n  <h4 class=\"mat-h4\" i18n=\"@@topnav_setpasswd_title\">\r\n    Set a new password\r\n  </h4>\r\n\r\n  <form [formGroup]=\"form\">\r\n    <div class=\"two-col\">\r\n      <div class=\"col\">\r\n        <div *ngIf=\"oldPasswordRequired\">\r\n          <mat-form-field appearance=\"outline\">\r\n            <mat-label i18n=\"@@topnav_oldpasswd\">Old Password</mat-label>\r\n            <input formControlName=\"psw\"\r\n                matInput\r\n                required\r\n                type=\"password\">\r\n            <mat-error i18n=\"@@topnav_field_required\">This field is required</mat-error>\r\n          </mat-form-field>\r\n        </div>\r\n        <div>\r\n          <mat-form-field appearance=\"outline\">\r\n            <mat-label i18n=\"@@topnav_newpasswd\">New Password</mat-label>\r\n            <input formControlName=\"new_psw\"\r\n                matInput\r\n                required\r\n                type=\"password\">\r\n            <mat-error *ngIf=\"newPassword.hasError('required')\"\r\n                i18n=\"@@topnav_field_required\">This field is required</mat-error>\r\n          </mat-form-field>\r\n        </div>\r\n        <div>\r\n          <mat-form-field appearance=\"outline\">\r\n            <mat-label i18n=\"@@topnav_confirmpasswd\">Confirm Password</mat-label>\r\n            <input formControlName=\"new_psw_confirm\"\r\n                matInput\r\n                required\r\n                type=\"password\">\r\n            <mat-error *ngIf=\"newPasswordConfirm.hasError('noPasswordMatch')\"\r\n                i18n=\"@@topnav_passwordnomatch\">Passwords do not match\r\n            </mat-error>\r\n            <mat-error *ngIf=\"newPasswordConfirm.hasError('required')\"\r\n                i18n=\"@@topnav_field_required\">This field is required</mat-error>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n      <div *ngIf=\"errorMessage\"\r\n          class=\"col error\">\r\n        <div [innerHTML]=\"errorMessage\"></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"actions\">\r\n      <button (click)=\"updatePassword()\"\r\n          color=\"primary\"\r\n          mat-flat-button\r\n          type=\"submit\"\r\n          [disabled]=\"form.invalid\"\r\n          i18n=\"@@topnav_savebtn\"\r\n      >Save\r\n      </button>\r\n    </div>\r\n  </form>\r\n</section>\r\n", styles: [".actions{margin-top:14px;text-align:right}.form-container{padding:14px 0;font-size:14px}.two-col{display:flex;flex-direction:row;flex-wrap:nowrap}.two-col .col{width:50%}.two-col .col .mat-mdc-form-field{width:95%}.two-col .error{color:#cb3d44}\n"], dependencies: [{ kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i6.MatButton, selector: "    button[mat-button], button[mat-raised-button], button[mat-flat-button],    button[mat-stroked-button]  ", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "directive", type: i7.MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["disabled", "id", "placeholder", "name", "required", "type", "errorStateMatcher", "aria-describedby", "value", "readonly"], exportAs: ["matInput"] }, { kind: "component", type: i8.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: i8.MatLabel, selector: "mat-label" }, { kind: "directive", type: i8.MatError, selector: "mat-error, [matError]", inputs: ["id"] }, { kind: "directive", type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i1.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { kind: "directive", type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i1.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: EditPasswordComponent, decorators: [{
            type: Component,
            args: [{ selector: 'mui-edit-password', changeDetection: ChangeDetectionStrategy.OnPush, template: "<section class=\"form-container\">\r\n  <h4 class=\"mat-h4\" i18n=\"@@topnav_setpasswd_title\">\r\n    Set a new password\r\n  </h4>\r\n\r\n  <form [formGroup]=\"form\">\r\n    <div class=\"two-col\">\r\n      <div class=\"col\">\r\n        <div *ngIf=\"oldPasswordRequired\">\r\n          <mat-form-field appearance=\"outline\">\r\n            <mat-label i18n=\"@@topnav_oldpasswd\">Old Password</mat-label>\r\n            <input formControlName=\"psw\"\r\n                matInput\r\n                required\r\n                type=\"password\">\r\n            <mat-error i18n=\"@@topnav_field_required\">This field is required</mat-error>\r\n          </mat-form-field>\r\n        </div>\r\n        <div>\r\n          <mat-form-field appearance=\"outline\">\r\n            <mat-label i18n=\"@@topnav_newpasswd\">New Password</mat-label>\r\n            <input formControlName=\"new_psw\"\r\n                matInput\r\n                required\r\n                type=\"password\">\r\n            <mat-error *ngIf=\"newPassword.hasError('required')\"\r\n                i18n=\"@@topnav_field_required\">This field is required</mat-error>\r\n          </mat-form-field>\r\n        </div>\r\n        <div>\r\n          <mat-form-field appearance=\"outline\">\r\n            <mat-label i18n=\"@@topnav_confirmpasswd\">Confirm Password</mat-label>\r\n            <input formControlName=\"new_psw_confirm\"\r\n                matInput\r\n                required\r\n                type=\"password\">\r\n            <mat-error *ngIf=\"newPasswordConfirm.hasError('noPasswordMatch')\"\r\n                i18n=\"@@topnav_passwordnomatch\">Passwords do not match\r\n            </mat-error>\r\n            <mat-error *ngIf=\"newPasswordConfirm.hasError('required')\"\r\n                i18n=\"@@topnav_field_required\">This field is required</mat-error>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n      <div *ngIf=\"errorMessage\"\r\n          class=\"col error\">\r\n        <div [innerHTML]=\"errorMessage\"></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"actions\">\r\n      <button (click)=\"updatePassword()\"\r\n          color=\"primary\"\r\n          mat-flat-button\r\n          type=\"submit\"\r\n          [disabled]=\"form.invalid\"\r\n          i18n=\"@@topnav_savebtn\"\r\n      >Save\r\n      </button>\r\n    </div>\r\n  </form>\r\n</section>\r\n", styles: [".actions{margin-top:14px;text-align:right}.form-container{padding:14px 0;font-size:14px}.two-col{display:flex;flex-direction:row;flex-wrap:nowrap}.two-col .col{width:50%}.two-col .col .mat-mdc-form-field{width:95%}.two-col .error{color:#cb3d44}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.UntypedFormBuilder }, { type: i2.HttpClient }, { type: i3.NotificationService }, { type: i4.DomSanitizer }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { userId: [{
                type: Input
            }], updatePasswordUrl: [{
                type: Input
            }], oldPasswordRequired: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdC1wYXNzd29yZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9tYXBwLXVpL2NvbW1vbi9zcmMvbGliL3RvcC1uYXZpZ2F0aW9uL2NvbXBvbmVudHMvZWRpdC1wYXNzd29yZC9lZGl0LXBhc3N3b3JkLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hcHAtdWkvY29tbW9uL3NyYy9saWIvdG9wLW5hdmlnYXRpb24vY29tcG9uZW50cy9lZGl0LXBhc3N3b3JkL2VkaXQtcGFzc3dvcmQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQyxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNqRixPQUFPLEVBQUUsdUJBQXVCLEVBQXFCLFNBQVMsRUFBRSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDckcsT0FBTyxFQUE0RCxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7OztBQVd0RyxNQUFNLE9BQU8scUJBQXFCO0lBY2hDLFlBQ1ksRUFBc0IsRUFDdEIsSUFBZ0IsRUFDaEIsRUFBdUIsRUFDdkIsU0FBdUIsRUFDdkIsRUFBcUI7UUFKckIsT0FBRSxHQUFGLEVBQUUsQ0FBb0I7UUFDdEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixPQUFFLEdBQUYsRUFBRSxDQUFxQjtRQUN2QixjQUFTLEdBQVQsU0FBUyxDQUFjO1FBQ3ZCLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBVmpDLHdCQUFtQixHQUFHLEtBQUssQ0FBQztJQVk1QixDQUFDO0lBRUQsSUFBSSxXQUFXO1FBQ2IsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQXVCLENBQUM7SUFDeEQsQ0FBQztJQUVELElBQUksa0JBQWtCO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FB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NEJBQ2IsT0FBTyxFQUFFO2dDQUNQLFFBQVEsRUFBRSx5QkFBeUI7Z0NBQ25DLElBQUksRUFBRSxHQUFHLENBQUMsT0FBTzs2QkFDbEI7eUJBQ0YsQ0FBQyxDQUFDO29CQUNMLENBQUM7aUJBQ0YsQ0FBQyxDQUFDO2FBQ1I7U0FFRjtJQUNILENBQUM7O21IQS9GVSxxQkFBcUI7dUdBQXJCLHFCQUFxQiwyS0NibEMsNjFFQThEQTs0RkRqRGEscUJBQXFCO2tCQU5qQyxTQUFTOytCQUNFLG1CQUFtQixtQkFHWix1QkFBdUIsQ0FBQyxNQUFNOytOQUsvQyxNQUFNO3NCQURMLEtBQUs7Z0JBSU4saUJBQWlCO3NCQURoQixLQUFLO2dCQUlOLG1CQUFtQjtzQkFEbEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBFcnJvclJlc3BvbnNlLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBVbnR5cGVkRm9ybUJ1aWxkZXIsIFVudHlwZWRGb3JtQ29udHJvbCwgVW50eXBlZEZvcm1Hcm91cCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHR5cGUgeyBTYWZlSHRtbCB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJ0BtYXBwLXVpL25vdGlmaWNhdGlvbi1jZW50ZXInO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtdWktZWRpdC1wYXNzd29yZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2VkaXQtcGFzc3dvcmQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2VkaXQtcGFzc3dvcmQuY29tcG9uZW50LnNjc3MnXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRWRpdFBhc3N3b3JkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQElucHV0KClcclxuICB1c2VySWQ6IHN0cmluZztcclxuXHJcbiAgQElucHV0KClcclxuICB1cGRhdGVQYXNzd29yZFVybDogc3RyaW5nO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIG9sZFBhc3N3b3JkUmVxdWlyZWQgPSBmYWxzZTtcclxuXHJcbiAgZm9ybTogVW50eXBlZEZvcm1Hcm91cDtcclxuICBlcnJvck1lc3NhZ2U6IFNhZmVIdG1sIHwgbnVsbDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICAgIHByaXZhdGUgZmI6IFVudHlwZWRGb3JtQnVpbGRlcixcclxuICAgICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxyXG4gICAgICBwcml2YXRlIG5jOiBOb3RpZmljYXRpb25TZXJ2aWNlLFxyXG4gICAgICBwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyLFxyXG4gICAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZlxyXG4gICkge1xyXG4gIH1cclxuXHJcbiAgZ2V0IG5ld1Bhc3N3b3JkKCk6IFVudHlwZWRGb3JtQ29udHJvbCB7XHJcbiAgICByZXR1cm4gdGhpcy5mb3JtLmdldCgnbmV3X3BzdycpIGFzIFVudHlwZWRGb3JtQ29udHJvbDtcclxuICB9XHJcblxyXG4gIGdldCBuZXdQYXNzd29yZENvbmZpcm0oKTogVW50eXBlZEZvcm1Db250cm9sIHtcclxuICAgIHJldHVybiB0aGlzLmZvcm0uZ2V0KCduZXdfcHN3X2NvbmZpcm0nKSBhcyBVbnR5cGVkRm9ybUNvbnRyb2w7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xyXG4gICAgICBuZXdfcHN3OiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxyXG4gICAgICBuZXdfcHN3X2NvbmZpcm06IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF1cclxuICAgIH0sIHtcclxuICAgICAgdmFsaWRhdG9yczogY29udHJvbCA9PiB7XHJcbiAgICAgICAgY29uc3QgcHN3ID0gY29udHJvbC5nZXQoJ25ld19wc3cnKT8udmFsdWU7XHJcbiAgICAgICAgY29uc3QgcHN3Q29uZmlybSA9IGNvbnRyb2wuZ2V0KCduZXdfcHN3X2NvbmZpcm0nKTtcclxuICAgICAgICBjb25zdCBwc3dDb25maXJtVmFsID0gcHN3Q29uZmlybT8udmFsdWU7XHJcbiAgICAgICAgaWYgKHBzd0NvbmZpcm1WYWwubGVuZ3RoID4gMCAmJiBwc3dDb25maXJtVmFsICE9PSBwc3cpIHtcclxuICAgICAgICAgIGNvbnN0IHBhc3N3b3JkTWF0Y2hFcnJvciA9IHsgbm9QYXNzd29yZE1hdGNoOiB0cnVlIH07XHJcbiAgICAgICAgICBwc3dDb25maXJtPy5zZXRFcnJvcnMocGFzc3dvcmRNYXRjaEVycm9yKTtcclxuICAgICAgICAgIHJldHVybiBwYXNzd29yZE1hdGNoRXJyb3I7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHRoaXMub2xkUGFzc3dvcmRSZXF1aXJlZCkge1xyXG4gICAgICB0aGlzLmZvcm0uYWRkQ29udHJvbCgncHN3JywgdGhpcy5mYi5jb250cm9sKCcnLCBWYWxpZGF0b3JzLnJlcXVpcmVkKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGVQYXNzd29yZCgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmZvcm0udmFsaWQpIHtcclxuICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZm9ybS52YWx1ZTtcclxuICAgICAgZGF0YS5zdWlkID0gdGhpcy51c2VySWQ7XHJcbiAgICAgIGRhdGEuYWN0aW9uID0gJ2NoYW5nZVN5c3RlbVVzZXJQYXNzd29yZCc7XHJcbiAgICAgIGRhdGEuZXJyb3JQYWdlID0gJy9pbmMvZWNFcnJvci5qc3AnO1xyXG4gICAgICBjb25zdCBib2R5ID0gbmV3IEh0dHBQYXJhbXMoeyBmcm9tT2JqZWN0OiBkYXRhIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2VIYW5kbGVyID0gKHJlczogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKHJlcy5pbmRleE9mKCdlYy1lcnJvcnMnKSA+IC0xKSB7XHJcbiAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RIdG1sKHJlcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubmMuYWRkTm90aWZpY2F0aW9uKHtcclxuICAgICAgICAgICAgdHlwZTogJ1NVQ0NFU1MnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiB7XHJcbiAgICAgICAgICAgICAgaGVhZGxpbmU6ICdQYXNzd29yZCB1cGRhdGVkIHN1Y2Nlc3NmdWxseS4nXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWYgKHRoaXMudXBkYXRlUGFzc3dvcmRVcmwpIHtcclxuICAgICAgICB0aGlzLmh0dHAucG9zdCh0aGlzLnVwZGF0ZVBhc3N3b3JkVXJsLCBib2R5LCB7IHJlc3BvbnNlVHlwZTogJ3RleHQnIH0pXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoe1xyXG4gICAgICAgICAgICAgIG5leHQ6IHJlc3BvbnNlSGFuZGxlcixcclxuICAgICAgICAgICAgICBlcnJvcjogKGVycjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmMuYWRkTm90aWZpY2F0aW9uKHtcclxuICAgICAgICAgICAgICAgICAgdHlwZTogJ0VSUk9SJyxcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRsaW5lOiAnUGFzc3dvcmQgdXBkYXRlIGZhaWxlZC4nLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IGVyci5tZXNzYWdlXHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iLCI8c2VjdGlvbiBjbGFzcz1cImZvcm0tY29udGFpbmVyXCI+XHJcbiAgPGg0IGNsYXNzPVwibWF0LWg0XCIgaTE4bj1cIkBAdG9wbmF2X3NldHBhc3N3ZF90aXRsZVwiPlxyXG4gICAgU2V0IGEgbmV3IHBhc3N3b3JkXHJcbiAgPC9oND5cclxuXHJcbiAgPGZvcm0gW2Zvcm1Hcm91cF09XCJmb3JtXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwidHdvLWNvbFwiPlxyXG4gICAgICA8ZGl2IGNsYXNzPVwiY29sXCI+XHJcbiAgICAgICAgPGRpdiAqbmdJZj1cIm9sZFBhc3N3b3JkUmVxdWlyZWRcIj5cclxuICAgICAgICAgIDxtYXQtZm9ybS1maWVsZCBhcHBlYXJhbmNlPVwib3V0bGluZVwiPlxyXG4gICAgICAgICAgICA8bWF0LWxhYmVsIGkxOG49XCJAQHRvcG5hdl9vbGRwYXNzd2RcIj5PbGQgUGFzc3dvcmQ8L21hdC1sYWJlbD5cclxuICAgICAgICAgICAgPGlucHV0IGZvcm1Db250cm9sTmFtZT1cInBzd1wiXHJcbiAgICAgICAgICAgICAgICBtYXRJbnB1dFxyXG4gICAgICAgICAgICAgICAgcmVxdWlyZWRcclxuICAgICAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiPlxyXG4gICAgICAgICAgICA8bWF0LWVycm9yIGkxOG49XCJAQHRvcG5hdl9maWVsZF9yZXF1aXJlZFwiPlRoaXMgZmllbGQgaXMgcmVxdWlyZWQ8L21hdC1lcnJvcj5cclxuICAgICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdj5cclxuICAgICAgICAgIDxtYXQtZm9ybS1maWVsZCBhcHBlYXJhbmNlPVwib3V0bGluZVwiPlxyXG4gICAgICAgICAgICA8bWF0LWxhYmVsIGkxOG49XCJAQHRvcG5hdl9uZXdwYXNzd2RcIj5OZXcgUGFzc3dvcmQ8L21hdC1sYWJlbD5cclxuICAgICAgICAgICAgPGlucHV0IGZvcm1Db250cm9sTmFtZT1cIm5ld19wc3dcIlxyXG4gICAgICAgICAgICAgICAgbWF0SW5wdXRcclxuICAgICAgICAgICAgICAgIHJlcXVpcmVkXHJcbiAgICAgICAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIj5cclxuICAgICAgICAgICAgPG1hdC1lcnJvciAqbmdJZj1cIm5ld1Bhc3N3b3JkLmhhc0Vycm9yKCdyZXF1aXJlZCcpXCJcclxuICAgICAgICAgICAgICAgIGkxOG49XCJAQHRvcG5hdl9maWVsZF9yZXF1aXJlZFwiPlRoaXMgZmllbGQgaXMgcmVxdWlyZWQ8L21hdC1lcnJvcj5cclxuICAgICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdj5cclxuICAgICAgICAgIDxtYXQtZm9ybS1maWVsZCBhcHBlYXJhbmNlPVwib3V0bGluZVwiPlxyXG4gICAgICAgICAgICA8bWF0LWxhYmVsIGkxOG49XCJAQHRvcG5hdl9jb25maXJtcGFzc3dkXCI+Q29uZmlybSBQYXNzd29yZDwvbWF0LWxhYmVsPlxyXG4gICAgICAgICAgICA8aW5wdXQgZm9ybUNvbnRyb2xOYW1lPVwibmV3X3Bzd19jb25maXJtXCJcclxuICAgICAgICAgICAgICAgIG1hdElucHV0XHJcbiAgICAgICAgICAgICAgICByZXF1aXJlZFxyXG4gICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCI+XHJcbiAgICAgICAgICAgIDxtYXQtZXJyb3IgKm5nSWY9XCJuZXdQYXNzd29yZENvbmZpcm0uaGFzRXJyb3IoJ25vUGFzc3dvcmRNYXRjaCcpXCJcclxuICAgICAgICAgICAgICAgIGkxOG49XCJAQHRvcG5hdl9wYXNzd29yZG5vbWF0Y2hcIj5QYXNzd29yZHMgZG8gbm90IG1hdGNoXHJcbiAgICAgICAgICAgIDwvbWF0LWVycm9yPlxyXG4gICAgICAgICAgICA8bWF0LWVycm9yICpuZ0lmPVwibmV3UGFzc3dvcmRDb25maXJtLmhhc0Vycm9yKCdyZXF1aXJlZCcpXCJcclxuICAgICAgICAgICAgICAgIGkxOG49XCJAQHRvcG5hdl9maWVsZF9yZXF1aXJlZFwiPlRoaXMgZmllbGQgaXMgcmVxdWlyZWQ8L21hdC1lcnJvcj5cclxuICAgICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2ICpuZ0lmPVwiZXJyb3JNZXNzYWdlXCJcclxuICAgICAgICAgIGNsYXNzPVwiY29sIGVycm9yXCI+XHJcbiAgICAgICAgPGRpdiBbaW5uZXJIVE1MXT1cImVycm9yTWVzc2FnZVwiPjwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIDxkaXYgY2xhc3M9XCJhY3Rpb25zXCI+XHJcbiAgICAgIDxidXR0b24gKGNsaWNrKT1cInVwZGF0ZVBhc3N3b3JkKClcIlxyXG4gICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcclxuICAgICAgICAgIG1hdC1mbGF0LWJ1dHRvblxyXG4gICAgICAgICAgdHlwZT1cInN1Ym1pdFwiXHJcbiAgICAgICAgICBbZGlzYWJsZWRdPVwiZm9ybS5pbnZhbGlkXCJcclxuICAgICAgICAgIGkxOG49XCJAQHRvcG5hdl9zYXZlYnRuXCJcclxuICAgICAgPlNhdmVcclxuICAgICAgPC9idXR0b24+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Zvcm0+XHJcbjwvc2VjdGlvbj5cclxuIl19