import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { LangChangeDialogComponent } from '../lang-change-dialog/lang-change-dialog.component';
import { TopNavDialogComponent } from '../top-nav-dialog/top-nav-dialog.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "../../services/session-timer.service";
import * as i3 from "../../services/top-navigation.service";
import * as i4 from "@angular/common";
import * as i5 from "@angular/material/menu";
import * as i6 from "@angular/material/button";
import * as i7 from "@angular/material/slide-toggle";
export class ProfileMenuComponent {
    constructor(dialog, timerService, topNavService) {
        this.dialog = dialog;
        this.timerService = timerService;
        this.topNavService = topNavService;
        this.isActiveMenu = false;
    }
    ngOnInit() {
        this.initSessionTimer();
        this.setUserInitials();
        this.prepareLanguageMenu();
    }
    onMenuOpened() {
        this.isActiveMenu = true;
    }
    onMenuClosed() {
        this.isActiveMenu = false;
    }
    onItemClicked(menuItem) {
        switch (menuItem.id) {
            case 'aux-user-settings':
                this.openAccountDialog(menuItem);
                break;
            default:
                this.handleGenericClick(menuItem);
        }
    }
    onLangMenuClicked(menuItem) {
        const config = {
            autoFocus: false,
            hasBackdrop: true,
            width: '500px'
        };
        const dialogRef = this.dialog.open(LangChangeDialogComponent, config);
        dialogRef.afterClosed().subscribe(res => {
            if (res === 'change' && menuItem.href) {
                this.topNavService.changeUILanguage(menuItem.href);
            }
        });
    }
    onSubMenuClosed() {
        // intentionally empty, just needed to refresh hover state in menu
    }
    toggleSessionTimer($event) {
        if ($event.checked) {
            this.timerService.stopKeepAlive();
        }
        else {
            this.timerService.startKeepAlive(true);
        }
    }
    openAccountDialog(item) {
        const config = {
            autoFocus: false,
            hasBackdrop: true,
            width: '700px',
            minHeight: 500,
            disableClose: true,
            panelClass: 'mui-top-nav-dialog',
            data: {
                ...item.properties,
                accountSettings: true
            }
        };
        this.dialog.open(TopNavDialogComponent, config);
    }
    handleGenericClick(menuItem) {
        if (menuItem.href) {
            window.location.assign(menuItem.href);
        }
    }
    setUserInitials() {
        const userName = this.navItem?.properties?.['userName'];
        if (userName) {
            this.userInitials = userName.split(' ')
                .reduce((prev, current) => {
                return prev + current.substring(0, 1);
            }, '');
        }
    }
    initSessionTimer() {
        const config = this.navItem?.menu?.find(itm => itm.id === 'aux-timer');
        if (config) {
            this.timerService.init(config);
        }
        this.isTimeoutActive$ = this.timerService.isTimeoutActive;
    }
    prepareLanguageMenu() {
        const mainLangEntry = this.navItem?.menu?.find(itm => itm.id === 'aux-user-lang');
        if (mainLangEntry && mainLangEntry.properties && mainLangEntry.menu) {
            const currentLangId = mainLangEntry.properties['currentLanguageId'];
            const index = mainLangEntry.menu.findIndex(i => i.id === currentLangId);
            if (index > -1) {
                const currentLangEntry = mainLangEntry.menu.splice(index, 1)[0];
                mainLangEntry.name = currentLangEntry.name;
            }
        }
    }
}
ProfileMenuComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: ProfileMenuComponent, deps: [{ token: i1.MatDialog }, { token: i2.SessionTimerService }, { token: i3.TopNavigationService }], target: i0.ɵɵFactoryTarget.Component });
ProfileMenuComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: ProfileMenuComponent, selector: "mui-profile-menu", inputs: { navItem: "navItem" }, ngImport: i0, template: "<button (menuClosed)=\"onMenuClosed()\"\r\n    (menuOpened)=\"onMenuOpened()\"\r\n    *ngIf=\"navItem.icon\"\r\n    [class.active]=\"isActiveMenu\"\r\n    [matMenuTriggerFor]=\"level2\"\r\n    class=\"mui-navitem-icon-btn\"\r\n    mat-icon-button\r\n    [id]=\"navItem.id\"\r\n>\r\n  <span *ngIf=\"!userInitials\"\r\n      class=\"mui-icons\">{{ navItem.icon }}</span>\r\n  <span *ngIf=\"userInitials\"\r\n      class=\"initials\">{{ userInitials }}</span>\r\n</button>\r\n\r\n<mat-menu #level2=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-container *ngFor=\"let menuItem of navItem.menu\">\r\n    <ng-container [ngSwitch]=\"menuItem.id\">\r\n      <button *ngSwitchCase=\"'aux-user-lang'\"\r\n          [matMenuTriggerData]=\"{items: menuItem.menu}\"\r\n          [matMenuTriggerFor]=\"level3\"\r\n          class=\"mui-navitem-button\"\r\n          mat-menu-item\r\n          (menuClosed)=\"onSubMenuClosed()\"\r\n          [id]=\"'2-' + menuItem.id\"\r\n      >\r\n        <span>{{ menuItem.name }}</span>\r\n      </button>\r\n      <div *ngSwitchCase=\"'aux-timer'\"\r\n          class=\"mui-navitem-button\"\r\n          mat-menu-item\r\n          [id]=\"'2-' + menuItem.id\"\r\n      >\r\n        <mat-slide-toggle\r\n            (change)=\"toggleSessionTimer($event)\"\r\n            [checked]=\"isTimeoutActive$ | async\"\r\n            color=\"primary\"\r\n            labelPosition=\"before\"\r\n        >{{ menuItem.name }}</mat-slide-toggle>\r\n      </div>\r\n      <button *ngSwitchDefault\r\n          (click)=\"onItemClicked(menuItem)\"\r\n          class=\"mui-navitem-button\"\r\n          mat-menu-item\r\n          [id]=\"'2-' + menuItem.id\"\r\n      >\r\n        <span>{{ menuItem.name }}</span>\r\n      </button>\r\n    </ng-container>\r\n  </ng-container>\r\n</mat-menu>\r\n\r\n<mat-menu #level3=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-template let-items=\"items\"\r\n      matMenuContent>\r\n    <button (click)=\"onLangMenuClicked(itm)\"\r\n        *ngFor=\"let itm of items\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        [id]=\"'3-' + itm.id\"\r\n    >{{ itm.name}}</button>\r\n  </ng-template>\r\n</mat-menu>\r\n", styles: [":host{display:block;width:48px;height:100%}.mui-auxnav-button{width:100%;height:100%;border-radius:0}.mui-navitem-icon-btn{width:48px;height:100%;border-radius:0}#aux-user{padding:0}.initials{font-size:14px;font-weight:400;font-family:Open Sans,sans-serif;display:inline-block;width:32px;height:32px;border-radius:50%;line-height:32px;position:relative;top:-2px}.mui-navitem-button{font-size:16px;font-weight:400;letter-spacing:.02px}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { kind: "directive", type: i4.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { kind: "directive", type: i4.NgSwitchDefault, selector: "[ngSwitchDefault]" }, { kind: "component", type: i5.MatMenu, selector: "mat-menu", exportAs: ["matMenu"] }, { kind: "component", type: i5.MatMenuItem, selector: "[mat-menu-item]", inputs: ["disabled", "disableRipple", "role"], exportAs: ["matMenuItem"] }, { kind: "directive", type: i5.MatMenuContent, selector: "ng-template[matMenuContent]" }, { kind: "directive", type: i5.MatMenuTrigger, selector: "[mat-menu-trigger-for], [matMenuTriggerFor]", exportAs: ["matMenuTrigger"] }, { kind: "component", type: i6.MatIconButton, selector: "button[mat-icon-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "component", type: i7.MatSlideToggle, selector: "mat-slide-toggle", inputs: ["disabled", "disableRipple", "color", "tabIndex"], exportAs: ["matSlideToggle"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: ProfileMenuComponent, decorators: [{
            type: Component,
            args: [{ selector: 'mui-profile-menu', changeDetection: ChangeDetectionStrategy.OnPush, template: "<button (menuClosed)=\"onMenuClosed()\"\r\n    (menuOpened)=\"onMenuOpened()\"\r\n    *ngIf=\"navItem.icon\"\r\n    [class.active]=\"isActiveMenu\"\r\n    [matMenuTriggerFor]=\"level2\"\r\n    class=\"mui-navitem-icon-btn\"\r\n    mat-icon-button\r\n    [id]=\"navItem.id\"\r\n>\r\n  <span *ngIf=\"!userInitials\"\r\n      class=\"mui-icons\">{{ navItem.icon }}</span>\r\n  <span *ngIf=\"userInitials\"\r\n      class=\"initials\">{{ userInitials }}</span>\r\n</button>\r\n\r\n<mat-menu #level2=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-container *ngFor=\"let menuItem of navItem.menu\">\r\n    <ng-container [ngSwitch]=\"menuItem.id\">\r\n      <button *ngSwitchCase=\"'aux-user-lang'\"\r\n          [matMenuTriggerData]=\"{items: menuItem.menu}\"\r\n          [matMenuTriggerFor]=\"level3\"\r\n          class=\"mui-navitem-button\"\r\n          mat-menu-item\r\n          (menuClosed)=\"onSubMenuClosed()\"\r\n          [id]=\"'2-' + menuItem.id\"\r\n      >\r\n        <span>{{ menuItem.name }}</span>\r\n      </button>\r\n      <div *ngSwitchCase=\"'aux-timer'\"\r\n          class=\"mui-navitem-button\"\r\n          mat-menu-item\r\n          [id]=\"'2-' + menuItem.id\"\r\n      >\r\n        <mat-slide-toggle\r\n            (change)=\"toggleSessionTimer($event)\"\r\n            [checked]=\"isTimeoutActive$ | async\"\r\n            color=\"primary\"\r\n            labelPosition=\"before\"\r\n        >{{ menuItem.name }}</mat-slide-toggle>\r\n      </div>\r\n      <button *ngSwitchDefault\r\n          (click)=\"onItemClicked(menuItem)\"\r\n          class=\"mui-navitem-button\"\r\n          mat-menu-item\r\n          [id]=\"'2-' + menuItem.id\"\r\n      >\r\n        <span>{{ menuItem.name }}</span>\r\n      </button>\r\n    </ng-container>\r\n  </ng-container>\r\n</mat-menu>\r\n\r\n<mat-menu #level3=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-template let-items=\"items\"\r\n      matMenuContent>\r\n    <button (click)=\"onLangMenuClicked(itm)\"\r\n        *ngFor=\"let itm of items\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        [id]=\"'3-' + itm.id\"\r\n    >{{ itm.name}}</button>\r\n  </ng-template>\r\n</mat-menu>\r\n", styles: [":host{display:block;width:48px;height:100%}.mui-auxnav-button{width:100%;height:100%;border-radius:0}.mui-navitem-icon-btn{width:48px;height:100%;border-radius:0}#aux-user{padding:0}.initials{font-size:14px;font-weight:400;font-family:Open Sans,sans-serif;display:inline-block;width:32px;height:32px;border-radius:50%;line-height:32px;position:relative;top:-2px}.mui-navitem-button{font-size:16px;font-weight:400;letter-spacing:.02px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.MatDialog }, { type: i2.SessionTimerService }, { type: i3.TopNavigationService }]; }, propDecorators: { navItem: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZmlsZS1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hcHAtdWkvY29tbW9uL3NyYy9saWIvdG9wLW5hdmlnYXRpb24vY29tcG9uZW50cy9wcm9maWxlLW1lbnUvcHJvZmlsZS1tZW51LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hcHAtdWkvY29tbW9uL3NyYy9saWIvdG9wLW5hdmlnYXRpb24vY29tcG9uZW50cy9wcm9maWxlLW1lbnUvcHJvZmlsZS1tZW51LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBT2xGLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBQy9GLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRDQUE0QyxDQUFDOzs7Ozs7Ozs7QUFRbkYsTUFBTSxPQUFPLG9CQUFvQjtJQVEvQixZQUNZLE1BQWlCLEVBQ2pCLFlBQWlDLEVBQ2pDLGFBQW1DO1FBRm5DLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsaUJBQVksR0FBWixZQUFZLENBQXFCO1FBQ2pDLGtCQUFhLEdBQWIsYUFBYSxDQUFzQjtRQVAvQyxpQkFBWSxHQUFHLEtBQUssQ0FBQztJQVNyQixDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQsWUFBWTtRQUNWLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO0lBQzNCLENBQUM7SUFFRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLFlBQVksR0FBRyxL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SSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDO0lBQzVELENBQUM7SUFFTyxtQkFBbUI7UUFDekIsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxlQUFlLENBQUMsQ0FBQztRQUNsRixJQUFJLGFBQWEsSUFBSSxhQUFhLENBQUMsVUFBVSxJQUFJLGFBQWEsQ0FBQyxJQUFJLEVBQUU7WUFDbkUsTUFBTSxhQUFhLEdBQUcsYUFBYSxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQ3BFLE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxhQUFhLENBQUMsQ0FBQztZQUN4RSxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDZCxNQUFNLGdCQUFnQixHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEUsYUFBYSxDQUFDLElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUM7YUFDNUM7U0FDRjtJQUNILENBQUM7O2tIQXZIVSxvQkFBb0I7c0dBQXBCLG9CQUFvQix3RkNoQmpDLDBwRUFpRUE7NEZEakRhLG9CQUFvQjtrQkFOaEMsU0FBUzsrQkFDRSxrQkFBa0IsbUJBR1gsdUJBQXVCLENBQUMsTUFBTTtxS0FJL0MsT0FBTztzQkFETixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNYXREaWFsb2csIE1hdERpYWxvZ0NvbmZpZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XHJcbmltcG9ydCB7IE1hdFNsaWRlVG9nZ2xlQ2hhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc2xpZGUtdG9nZ2xlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBOYXZJdGVtIH0gZnJvbSAnLi4vLi4vY29yZS9tb2RlbHMvbmF2aWdhdGlvbic7XHJcbmltcG9ydCB7IFNlc3Npb25UaW1lclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zZXNzaW9uLXRpbWVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBUb3BOYXZpZ2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3RvcC1uYXZpZ2F0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMYW5nQ2hhbmdlRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnLi4vbGFuZy1jaGFuZ2UtZGlhbG9nL2xhbmctY2hhbmdlLWRpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBUb3BOYXZEaWFsb2dDb21wb25lbnQgfSBmcm9tICcuLi90b3AtbmF2LWRpYWxvZy90b3AtbmF2LWRpYWxvZy5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtdWktcHJvZmlsZS1tZW51JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcHJvZmlsZS1tZW51LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9wcm9maWxlLW1lbnUuY29tcG9uZW50LnNjc3MnXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgUHJvZmlsZU1lbnVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBJbnB1dCgpXHJcbiAgbmF2SXRlbTogTmF2SXRlbTtcclxuXHJcbiAgaXNBY3RpdmVNZW51ID0gZmFsc2U7XHJcbiAgdXNlckluaXRpYWxzOiBzdHJpbmc7XHJcbiAgaXNUaW1lb3V0QWN0aXZlJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICAgIHByaXZhdGUgZGlhbG9nOiBNYXREaWFsb2csXHJcbiAgICAgIHByaXZhdGUgdGltZXJTZXJ2aWNlOiBTZXNzaW9uVGltZXJTZXJ2aWNlLFxyXG4gICAgICBwcml2YXRlIHRvcE5hdlNlcnZpY2U6IFRvcE5hdmlnYXRpb25TZXJ2aWNlXHJcbiAgKSB7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuaW5pdFNlc3Npb25UaW1lcigpO1xyXG4gICAgdGhpcy5zZXRVc2VySW5pdGlhbHMoKTtcclxuICAgIHRoaXMucHJlcGFyZUxhbmd1YWdlTWVudSgpO1xyXG4gIH1cclxuXHJcbiAgb25NZW51T3BlbmVkKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pc0FjdGl2ZU1lbnUgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgb25NZW51Q2xvc2VkKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pc0FjdGl2ZU1lbnUgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIG9uSXRlbUNsaWNrZWQobWVudUl0ZW06IE5hdkl0ZW0pOiB2b2lkIHtcclxuICAgIHN3aXRjaCAobWVudUl0ZW0uaWQpIHtcclxuICAgICAgY2FzZSAnYXV4LXVzZXItc2V0dGluZ3MnOlxyXG4gICAgICAgIHRoaXMub3BlbkFjY291bnREaWFsb2cobWVudUl0ZW0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRoaXMuaGFuZGxlR2VuZXJpY0NsaWNrKG1lbnVJdGVtKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uTGFuZ01lbnVDbGlja2VkKG1lbnVJdGVtOiBOYXZJdGVtKTogdm9pZCB7XHJcbiAgICBjb25zdCBjb25maWc6IE1hdERpYWxvZ0NvbmZpZyA9IHtcclxuICAgICAgYXV0b0ZvY3VzOiBmYWxzZSxcclxuICAgICAgaGFzQmFja2Ryb3A6IHRydWUsXHJcbiAgICAgIHdpZHRoOiAnNTAwcHgnXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oTGFuZ0NoYW5nZURpYWxvZ0NvbXBvbmVudCwgY29uZmlnKTtcclxuICAgIGRpYWxvZ1JlZi5hZnRlckNsb3NlZCgpLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzID09PSAnY2hhbmdlJyAmJiBtZW51SXRlbS5ocmVmKSB7XHJcbiAgICAgICAgdGhpcy50b3BOYXZTZXJ2aWNlLmNoYW5nZVVJTGFuZ3VhZ2UobWVudUl0ZW0uaHJlZik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb25TdWJNZW51Q2xvc2VkKCk6IHZvaWQge1xyXG4gICAgLy8gaW50ZW50aW9uYWxseSBlbXB0eSwganVzdCBuZWVkZWQgdG8gcmVmcmVzaCBob3ZlciBzdGF0ZSBpbiBtZW51XHJcbiAgfVxyXG5cclxuICB0b2dnbGVTZXNzaW9uVGltZXIoJGV2ZW50OiBNYXRTbGlkZVRvZ2dsZUNoYW5nZSk6IHZvaWQge1xyXG4gICAgaWYgKCRldmVudC5jaGVja2VkKSB7XHJcbiAgICAgIHRoaXMudGltZXJTZXJ2aWNlLnN0b3BLZWVwQWxpdmUoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudGltZXJTZXJ2aWNlLnN0YXJ0S2VlcEFsaXZlKHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvcGVuQWNjb3VudERpYWxvZyhpdGVtOiBOYXZJdGVtKTogdm9pZCB7XHJcbiAgICBjb25zdCBjb25maWc6IE1hdERpYWxvZ0NvbmZpZyA9IHtcclxuICAgICAgYXV0b0ZvY3VzOiBmYWxzZSxcclxuICAgICAgaGFzQmFja2Ryb3A6IHRydWUsXHJcbiAgICAgIHdpZHRoOiAnNzAwcHgnLFxyXG4gICAgICBtaW5IZWlnaHQ6IDUwMCxcclxuICAgICAgZGlzYWJsZUNsb3NlOiB0cnVlLFxyXG4gICAgICBwYW5lbENsYXNzOiAnbXVpLXRvcC1uYXYtZGlhbG9nJyxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIC4uLml0ZW0ucHJvcGVydGllcyxcclxuICAgICAgICBhY2NvdW50U2V0dGluZ3M6IHRydWVcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmRpYWxvZy5vcGVuKFRvcE5hdkRpYWxvZ0NvbXBvbmVudCwgY29uZmlnKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlR2VuZXJpY0NsaWNrKG1lbnVJdGVtOiBOYXZJdGVtKTogdm9pZCB7XHJcbiAgICBpZiAobWVudUl0ZW0uaHJlZikge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKG1lbnVJdGVtLmhyZWYpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRVc2VySW5pdGlhbHMoKTogdm9pZCB7XHJcbiAgICBjb25zdCB1c2VyTmFtZSA9IHRoaXMubmF2SXRlbT8ucHJvcGVydGllcz8uWyd1c2VyTmFtZSddIGFzIHN0cmluZztcclxuICAgIGlmICh1c2VyTmFtZSkge1xyXG4gICAgICB0aGlzLnVzZXJJbml0aWFscyA9IHVzZXJOYW1lLnNwbGl0KCcgJylcclxuICAgICAgICAgIC5yZWR1Y2UoKFxyXG4gICAgICAgICAgICAgIHByZXYsXHJcbiAgICAgICAgICAgICAgY3VycmVudCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJldiArIGN1cnJlbnQuc3Vic3RyaW5nKDAsIDEpO1xyXG4gICAgICAgICAgfSwgJycpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0U2Vzc2lvblRpbWVyKCk6IHZvaWQge1xyXG4gICAgY29uc3QgY29uZmlnID0gdGhpcy5uYXZJdGVtPy5tZW51Py5maW5kKGl0bSA9PiBpdG0uaWQgPT09ICdhdXgtdGltZXInKTtcclxuICAgIGlmIChjb25maWcpIHtcclxuICAgICAgdGhpcy50aW1lclNlcnZpY2UuaW5pdChjb25maWcpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pc1RpbWVvdXRBY3RpdmUkID0gdGhpcy50aW1lclNlcnZpY2UuaXNUaW1lb3V0QWN0aXZlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwcmVwYXJlTGFuZ3VhZ2VNZW51KCk6IHZvaWQge1xyXG4gICAgY29uc3QgbWFpbkxhbmdFbnRyeSA9IHRoaXMubmF2SXRlbT8ubWVudT8uZmluZChpdG0gPT4gaXRtLmlkID09PSAnYXV4LXVzZXItbGFuZycpO1xyXG4gICAgaWYgKG1haW5MYW5nRW50cnkgJiYgbWFpbkxhbmdFbnRyeS5wcm9wZXJ0aWVzICYmIG1haW5MYW5nRW50cnkubWVudSkge1xyXG4gICAgICBjb25zdCBjdXJyZW50TGFuZ0lkID0gbWFpbkxhbmdFbnRyeS5wcm9wZXJ0aWVzWydjdXJyZW50TGFuZ3VhZ2VJZCddO1xyXG4gICAgICBjb25zdCBpbmRleCA9IG1haW5MYW5nRW50cnkubWVudS5maW5kSW5kZXgoaSA9PiBpLmlkID09PSBjdXJyZW50TGFuZ0lkKTtcclxuICAgICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgICBjb25zdCBjdXJyZW50TGFuZ0VudHJ5ID0gbWFpbkxhbmdFbnRyeS5tZW51LnNwbGljZShpbmRleCwgMSlbMF07XHJcbiAgICAgICAgbWFpbkxhbmdFbnRyeS5uYW1lID0gY3VycmVudExhbmdFbnRyeS5uYW1lO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iLCI8YnV0dG9uIChtZW51Q2xvc2VkKT1cIm9uTWVudUNsb3NlZCgpXCJcclxuICAgIChtZW51T3BlbmVkKT1cIm9uTWVudU9wZW5lZCgpXCJcclxuICAgICpuZ0lmPVwibmF2SXRlbS5pY29uXCJcclxuICAgIFtjbGFzcy5hY3RpdmVdPVwiaXNBY3RpdmVNZW51XCJcclxuICAgIFttYXRNZW51VHJpZ2dlckZvcl09XCJsZXZlbDJcIlxyXG4gICAgY2xhc3M9XCJtdWktbmF2aXRlbS1pY29uLWJ0blwiXHJcbiAgICBtYXQtaWNvbi1idXR0b25cclxuICAgIFtpZF09XCJuYXZJdGVtLmlkXCJcclxuPlxyXG4gIDxzcGFuICpuZ0lmPVwiIXVzZXJJbml0aWFsc1wiXHJcbiAgICAgIGNsYXNzPVwibXVpLWljb25zXCI+e3sgbmF2SXRlbS5pY29uIH19PC9zcGFuPlxyXG4gIDxzcGFuICpuZ0lmPVwidXNlckluaXRpYWxzXCJcclxuICAgICAgY2xhc3M9XCJpbml0aWFsc1wiPnt7IHVzZXJJbml0aWFscyB9fTwvc3Bhbj5cclxuPC9idXR0b24+XHJcblxyXG48bWF0LW1lbnUgI2xldmVsMj1cIm1hdE1lbnVcIlxyXG4gICAgY2xhc3M9XCJtdWktbmF2aXRlbS1tZW51XCI+XHJcbiAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgbWVudUl0ZW0gb2YgbmF2SXRlbS5tZW51XCI+XHJcbiAgICA8bmctY29udGFpbmVyIFtuZ1N3aXRjaF09XCJtZW51SXRlbS5pZFwiPlxyXG4gICAgICA8YnV0dG9uICpuZ1N3aXRjaENhc2U9XCInYXV4LXVzZXItbGFuZydcIlxyXG4gICAgICAgICAgW21hdE1lbnVUcmlnZ2VyRGF0YV09XCJ7aXRlbXM6IG1lbnVJdGVtLm1lbnV9XCJcclxuICAgICAgICAgIFttYXRNZW51VHJpZ2dlckZvcl09XCJsZXZlbDNcIlxyXG4gICAgICAgICAgY2xhc3M9XCJtdWktbmF2aXRlbS1idXR0b25cIlxyXG4gICAgICAgICAgbWF0LW1lbnUtaXRlbVxyXG4gICAgICAgICAgKG1lbnVDbG9zZWQpPVwib25TdWJNZW51Q2xvc2VkKClcIlxyXG4gICAgICAgICAgW2lkXT1cIicyLScgKyBtZW51SXRlbS5pZFwiXHJcbiAgICAgID5cclxuICAgICAgICA8c3Bhbj57eyBtZW51SXRlbS5uYW1lIH19PC9zcGFuPlxyXG4gICAgICA8L2J1dHRvbj5cclxuICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVwiJ2F1eC10aW1lcidcIlxyXG4gICAgICAgICAgY2xhc3M9XCJtdWktbmF2aXRlbS1idXR0b25cIlxyXG4gICAgICAgICAgbWF0LW1lbnUtaXRlbVxyXG4gICAgICAgICAgW2lkXT1cIicyLScgKyBtZW51SXRlbS5pZFwiXHJcbiAgICAgID5cclxuICAgICAgICA8bWF0LXNsaWRlLXRvZ2dsZVxyXG4gICAgICAgICAgICAoY2hhbmdlKT1cInRvZ2dsZVNlc3Npb25UaW1lcigkZXZlbnQpXCJcclxuICAgICAgICAgICAgW2NoZWNrZWRdPVwiaXNUaW1lb3V0QWN0aXZlJCB8IGFzeW5jXCJcclxuICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcclxuICAgICAgICAgICAgbGFiZWxQb3NpdGlvbj1cImJlZm9yZVwiXHJcbiAgICAgICAgPnt7IG1lbnVJdGVtLm5hbWUgfX08L21hdC1zbGlkZS10b2dnbGU+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8YnV0dG9uICpuZ1N3aXRjaERlZmF1bHRcclxuICAgICAgICAgIChjbGljayk9XCJvbkl0ZW1DbGlja2VkKG1lbnVJdGVtKVwiXHJcbiAgICAgICAgICBjbGFzcz1cIm11aS1uYXZpdGVtLWJ1dHRvblwiXHJcbiAgICAgICAgICBtYXQtbWVudS1pdGVtXHJcbiAgICAgICAgICBbaWRdPVwiJzItJyArIG1lbnVJdGVtLmlkXCJcclxuICAgICAgPlxyXG4gICAgICAgIDxzcGFuPnt7IG1lbnVJdGVtLm5hbWUgfX08L3NwYW4+XHJcbiAgICAgIDwvYnV0dG9uPlxyXG4gICAgPC9uZy1jb250YWluZXI+XHJcbiAgPC9uZy1jb250YWluZXI+XHJcbjwvbWF0LW1lbnU+XHJcblxyXG48bWF0LW1lbnUgI2xldmVsMz1cIm1hdE1lbnVcIlxyXG4gICAgY2xhc3M9XCJtdWktbmF2aXRlbS1tZW51XCI+XHJcbiAgPG5nLXRlbXBsYXRlIGxldC1pdGVtcz1cIml0ZW1zXCJcclxuICAgICAgbWF0TWVudUNvbnRlbnQ+XHJcbiAgICA8YnV0dG9uIChjbGljayk9XCJvbkxhbmdNZW51Q2xpY2tlZChpdG0pXCJcclxuICAgICAgICAqbmdGb3I9XCJsZXQgaXRtIG9mIGl0ZW1zXCJcclxuICAgICAgICBjbGFzcz1cIm11aS1uYXZpdGVtLWJ1dHRvblwiXHJcbiAgICAgICAgbWF0LW1lbnUtaXRlbVxyXG4gICAgICAgIFtpZF09XCInMy0nICsgaXRtLmlkXCJcclxuICAgID57eyBpdG0ubmFtZX19PC9idXR0b24+XHJcbiAgPC9uZy10ZW1wbGF0ZT5cclxuPC9tYXQtbWVudT5cclxuIl19