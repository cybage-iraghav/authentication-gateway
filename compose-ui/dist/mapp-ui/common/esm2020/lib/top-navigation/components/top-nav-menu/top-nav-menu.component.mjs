import { DOCUMENT } from '@angular/common';
import { ChangeDetectionStrategy, Component, HostBinding, Inject, Input } from '@angular/core';
import { map } from 'rxjs/operators';
import { TopNavDialogComponent } from '../top-nav-dialog/top-nav-dialog.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "../../services/top-navigation.service";
import * as i3 from "@angular/router";
import * as i4 from "@angular/common";
import * as i5 from "@angular/material/menu";
import * as i6 from "@angular/material/button";
export class TopNavMenuComponent {
    constructor(dialog, service, document, router) {
        this.dialog = dialog;
        this.service = service;
        this.document = document;
        this.router = router;
        this.hostClassName = 'mui-top-nav-menu';
        this.isActiveMenu = false;
        this.baseHref = this.document.getElementsByTagName('base')?.[0]?.href;
    }
    onItemClicked(menuItem, event) {
        event.preventDefault();
        if (menuItem.id === 'aux-help-onlinehelp' && menuItem.href) {
            this.openHelpLink(menuItem.href);
        }
        else if (menuItem.properties?.['blank']) {
            window.open(menuItem.href);
        }
        else if (menuItem.properties?.['modal']) {
            this.openDialog(menuItem);
        }
        else if (menuItem.href) {
            this.navigateTo(menuItem.href);
        }
    }
    onMenuOpened() {
        this.isActiveMenu = true;
    }
    onMenuClosed() {
        this.isActiveMenu = false;
    }
    onSubMenuClosed() {
        // intentionally empty, just needed to refresh hover state in menu
    }
    ngOnInit() {
        this.isHighlightedMenu = this.service.activeMenuIdChanges
            .pipe(map(val => this.navItem.id === val));
    }
    /**
     * Navigate to a different view in Engage.
     * Navigation target and methodology is resolved by following logic:
     * 1. If target link has same base href as the document, strip it from the link to have path only
     * 2. If target link had no match for base href, or no router available, set location to target link
     * 3. Try to use the Angular router to navigate to the url (fragment)
     * 4. If router navigation failed, assign location
     */
    navigateTo(url) {
        this.service.activeNavMenuId = this.navItem.id;
        const routingPath = url.replace(this.baseHref, '');
        if (/https?:\/{2}/.test(routingPath) || this.router.config.length === 0) {
            window.location.assign(url);
        }
        else {
            const parsedUrl = this.router.parseUrl(routingPath);
            const navigateResult = this.router.navigateByUrl(parsedUrl.fragment ?? parsedUrl);
            navigateResult.catch(() => {
                window.location.assign(url);
            });
        }
    }
    openDialog(menuItem) {
        const config = {
            width: '600px',
            height: '500px',
            autoFocus: false,
            data: {
                title: menuItem.properties?.['title'],
                srcUrl: menuItem.href,
                additionalContent: this.service.getServiceVersionInfos()
            }
        };
        this.dialog.open(TopNavDialogComponent, config);
    }
    openHelpLink(url) {
        try {
            const updatedHelpLink = this.service.getUpdatedHelpLink(url);
            window.open(updatedHelpLink);
        }
        catch (e) {
            console.error('help link malformed', e);
        }
    }
}
TopNavMenuComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: TopNavMenuComponent, deps: [{ token: i1.MatDialog }, { token: i2.TopNavigationService }, { token: DOCUMENT }, { token: i3.Router }], target: i0.ɵɵFactoryTarget.Component });
TopNavMenuComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: TopNavMenuComponent, selector: "mui-top-nav-menu", inputs: { navItem: "navItem" }, host: { properties: { "class": "this.hostClassName" } }, ngImport: i0, template: "<div *ngIf=\"navItem.icon && navItem.href\"\r\n    class=\"mui-navitem-icon\">\r\n  <a [href]=\"navItem.href\"\r\n      [id]=\"navItem.id\"\r\n  >\r\n    <span class=\"mui-icons\">{{ navItem.icon }}</span>\r\n  </a>\r\n</div>\r\n\r\n<button (menuClosed)=\"onMenuClosed()\"\r\n    (menuOpened)=\"onMenuOpened()\"\r\n    *ngIf=\"navItem.icon && navItem.menu\"\r\n    [class.active]=\"isActiveMenu || (isHighlightedMenu | async)\"\r\n    [matMenuTriggerFor]=\"level2\"\r\n    class=\"mui-navitem-icon-btn\"\r\n    mat-icon-button\r\n    [id]=\"navItem.id\"\r\n>\r\n  <span class=\"mui-icons\">{{ navItem.icon }}</span>\r\n</button>\r\n\r\n<button (menuClosed)=\"onMenuClosed()\"\r\n    (menuOpened)=\"onMenuOpened()\"\r\n    *ngIf=\"navItem.name\"\r\n    [class.active]=\"isActiveMenu || (isHighlightedMenu | async)\"\r\n    [matMenuTriggerFor]=\"level2\"\r\n    class=\"mui-navitem-parent\"\r\n    mat-button\r\n    [id]=\"navItem.id\"\r\n>\r\n  <span>{{ navItem.name }}</span>\r\n  <span class=\"mui-icons\">chevron_down</span>\r\n</button>\r\n\r\n<mat-menu #level2=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-container *ngFor=\"let menuItem of navItem.menu\">\r\n    <a (click)=\"onItemClicked(menuItem, $event)\"\r\n        *ngIf=\"menuItem.href\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        [id]=\"'2-' + menuItem.id\"\r\n        [href]=\"menuItem.href\"\r\n    >\r\n      <span *ngIf=\"menuItem.icon\"\r\n          class=\"mui-icons\">{{ menuItem.icon }}</span>\r\n      <span>{{ menuItem.name }}</span>\r\n    </a>\r\n    <button *ngIf=\"menuItem.menu\"\r\n        [matMenuTriggerData]=\"{items: menuItem.menu}\"\r\n        [matMenuTriggerFor]=\"level3\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        (menuClosed)=\"onSubMenuClosed()\"\r\n        [id]=\"'2-' + menuItem.id\"\r\n    >\r\n      <span>{{ menuItem.name }}</span>\r\n    </button>\r\n\r\n  </ng-container>\r\n</mat-menu>\r\n\r\n<mat-menu #level3=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-template let-items=\"items\"\r\n    matMenuContent>\r\n    <a (click)=\"onItemClicked(itm, $event)\"\r\n        *ngFor=\"let itm of items\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        [id]=\"'3-' + itm.id\"\r\n        [href]=\"itm.href\"\r\n    >{{ itm.name}}</a>\r\n  </ng-template>\r\n</mat-menu>\r\n\r\n", styles: [":host{display:block;height:100%}.mui-navitem-icon{width:48px;height:100%}.mui-navitem-icon a{color:#fff;display:inline-block;position:relative;top:13px;left:12px}.mui-navitem-icon-btn{width:48px;height:100%;border-radius:0}.mui-navitem-parent{font-size:16px;font-weight:600;height:48px;border-radius:0;letter-spacing:.02px;padding:0 8px;margin:0 2px;white-space:nowrap}.mui-navitem-parent .mui-icons{font-size:12px;margin-left:8px}.mui-navitem-button{font-size:16px;font-weight:400;letter-spacing:.02px}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i5.MatMenu, selector: "mat-menu", exportAs: ["matMenu"] }, { kind: "component", type: i5.MatMenuItem, selector: "[mat-menu-item]", inputs: ["disabled", "disableRipple", "role"], exportAs: ["matMenuItem"] }, { kind: "directive", type: i5.MatMenuContent, selector: "ng-template[matMenuContent]" }, { kind: "directive", type: i5.MatMenuTrigger, selector: "[mat-menu-trigger-for], [matMenuTriggerFor]", exportAs: ["matMenuTrigger"] }, { kind: "component", type: i6.MatButton, selector: "    button[mat-button], button[mat-raised-button], button[mat-flat-button],    button[mat-stroked-button]  ", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "component", type: i6.MatIconButton, selector: "button[mat-icon-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: TopNavMenuComponent, decorators: [{
            type: Component,
            args: [{ selector: 'mui-top-nav-menu', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div *ngIf=\"navItem.icon && navItem.href\"\r\n    class=\"mui-navitem-icon\">\r\n  <a [href]=\"navItem.href\"\r\n      [id]=\"navItem.id\"\r\n  >\r\n    <span class=\"mui-icons\">{{ navItem.icon }}</span>\r\n  </a>\r\n</div>\r\n\r\n<button (menuClosed)=\"onMenuClosed()\"\r\n    (menuOpened)=\"onMenuOpened()\"\r\n    *ngIf=\"navItem.icon && navItem.menu\"\r\n    [class.active]=\"isActiveMenu || (isHighlightedMenu | async)\"\r\n    [matMenuTriggerFor]=\"level2\"\r\n    class=\"mui-navitem-icon-btn\"\r\n    mat-icon-button\r\n    [id]=\"navItem.id\"\r\n>\r\n  <span class=\"mui-icons\">{{ navItem.icon }}</span>\r\n</button>\r\n\r\n<button (menuClosed)=\"onMenuClosed()\"\r\n    (menuOpened)=\"onMenuOpened()\"\r\n    *ngIf=\"navItem.name\"\r\n    [class.active]=\"isActiveMenu || (isHighlightedMenu | async)\"\r\n    [matMenuTriggerFor]=\"level2\"\r\n    class=\"mui-navitem-parent\"\r\n    mat-button\r\n    [id]=\"navItem.id\"\r\n>\r\n  <span>{{ navItem.name }}</span>\r\n  <span class=\"mui-icons\">chevron_down</span>\r\n</button>\r\n\r\n<mat-menu #level2=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-container *ngFor=\"let menuItem of navItem.menu\">\r\n    <a (click)=\"onItemClicked(menuItem, $event)\"\r\n        *ngIf=\"menuItem.href\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        [id]=\"'2-' + menuItem.id\"\r\n        [href]=\"menuItem.href\"\r\n    >\r\n      <span *ngIf=\"menuItem.icon\"\r\n          class=\"mui-icons\">{{ menuItem.icon }}</span>\r\n      <span>{{ menuItem.name }}</span>\r\n    </a>\r\n    <button *ngIf=\"menuItem.menu\"\r\n        [matMenuTriggerData]=\"{items: menuItem.menu}\"\r\n        [matMenuTriggerFor]=\"level3\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        (menuClosed)=\"onSubMenuClosed()\"\r\n        [id]=\"'2-' + menuItem.id\"\r\n    >\r\n      <span>{{ menuItem.name }}</span>\r\n    </button>\r\n\r\n  </ng-container>\r\n</mat-menu>\r\n\r\n<mat-menu #level3=\"matMenu\"\r\n    class=\"mui-navitem-menu\">\r\n  <ng-template let-items=\"items\"\r\n    matMenuContent>\r\n    <a (click)=\"onItemClicked(itm, $event)\"\r\n        *ngFor=\"let itm of items\"\r\n        class=\"mui-navitem-button\"\r\n        mat-menu-item\r\n        [id]=\"'3-' + itm.id\"\r\n        [href]=\"itm.href\"\r\n    >{{ itm.name}}</a>\r\n  </ng-template>\r\n</mat-menu>\r\n\r\n", styles: [":host{display:block;height:100%}.mui-navitem-icon{width:48px;height:100%}.mui-navitem-icon a{color:#fff;display:inline-block;position:relative;top:13px;left:12px}.mui-navitem-icon-btn{width:48px;height:100%;border-radius:0}.mui-navitem-parent{font-size:16px;font-weight:600;height:48px;border-radius:0;letter-spacing:.02px;padding:0 8px;margin:0 2px;white-space:nowrap}.mui-navitem-parent .mui-icons{font-size:12px;margin-left:8px}.mui-navitem-button{font-size:16px;font-weight:400;letter-spacing:.02px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.MatDialog }, { type: i2.TopNavigationService }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }, { type: i3.Router }]; }, propDecorators: { hostClassName: [{
                type: HostBinding,
                args: ['class']
            }], navItem: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9wLW5hdi1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hcHAtdWkvY29tbW9uL3NyYy9saWIvdG9wLW5hdmlnYXRpb24vY29tcG9uZW50cy90b3AtbmF2LW1lbnUvdG9wLW5hdi1tZW51LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hcHAtdWkvY29tbW9uL3NyYy9saWIvdG9wLW5hdmlnYXRpb24vY29tcG9uZW50cy90b3AtbmF2LW1lbnUvdG9wLW5hdi1tZW51LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBSXZHLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUdyQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQzs7Ozs7Ozs7QUFRbkYsTUFBTSxPQUFPLG1CQUFtQjtJQWE5QixZQUNZLE1BQWlCLEVBQ2pCLE9BQTZCLEVBQ1gsUUFBa0IsRUFDcEMsTUFBYztRQUhkLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsWUFBTyxHQUFQLE9BQU8sQ0FBc0I7UUFDWCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ3BDLFdBQU0sR0FBTixNQUFNLENBQVE7UUFkMUIsa0JBQWEsR0FBRyxrQkFBa0IsQ0FBQztRQU1uQyxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQVVuQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENB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QUNGLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0QsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztTQUM5QjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN6QztJQUNILENBQUM7O2lIQS9GVSxtQkFBbUIsK0VBZ0JsQixRQUFRO3FHQWhCVCxtQkFBbUIsaUpDaEJoQyw4MEVBNEVBOzRGRDVEYSxtQkFBbUI7a0JBTi9CLFNBQVM7K0JBQ0Usa0JBQWtCLG1CQUdYLHVCQUF1QixDQUFDLE1BQU07OzBCQWtCMUMsTUFBTTsyQkFBQyxRQUFRO2lFQWJwQixhQUFhO3NCQURaLFdBQVc7dUJBQUMsT0FBTztnQkFJcEIsT0FBTztzQkFETixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBIb3N0QmluZGluZywgSW5qZWN0LCBJbnB1dCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1hdERpYWxvZywgTWF0RGlhbG9nQ29uZmlnIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcclxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IE5hdkl0ZW0gfSBmcm9tICcuLi8uLi9jb3JlL21vZGVscy9uYXZpZ2F0aW9uJztcclxuaW1wb3J0IHsgVG9wTmF2aWdhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy90b3AtbmF2aWdhdGlvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVG9wTmF2RGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnLi4vdG9wLW5hdi1kaWFsb2cvdG9wLW5hdi1kaWFsb2cuY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbXVpLXRvcC1uYXYtbWVudScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3RvcC1uYXYtbWVudS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdG9wLW5hdi1tZW51LmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIFRvcE5hdk1lbnVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBob3N0Q2xhc3NOYW1lID0gJ211aS10b3AtbmF2LW1lbnUnO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIG5hdkl0ZW06IE5hdkl0ZW07XHJcblxyXG4gIGlzSGlnaGxpZ2h0ZWRNZW51OiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG4gIGlzQWN0aXZlTWVudSA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGJhc2VIcmVmOiBzdHJpbmc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgICBwcml2YXRlIGRpYWxvZzogTWF0RGlhbG9nLFxyXG4gICAgICBwcml2YXRlIHNlcnZpY2U6IFRvcE5hdmlnYXRpb25TZXJ2aWNlLFxyXG4gICAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50OiBEb2N1bWVudCxcclxuICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlclxyXG4gICkge1xyXG4gICAgdGhpcy5iYXNlSHJlZiA9IHRoaXMuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2Jhc2UnKT8uWzBdPy5ocmVmO1xyXG4gIH1cclxuXHJcbiAgb25JdGVtQ2xpY2tlZChtZW51SXRlbTogTmF2SXRlbSwgZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBpZiAobWVudUl0ZW0uaWQgPT09ICdhdXgtaGVscC1vbmxpbmVoZWxwJyAmJiBtZW51SXRlbS5ocmVmKSB7XHJcbiAgICAgIHRoaXMub3BlbkhlbHBMaW5rKG1lbnVJdGVtLmhyZWYpO1xyXG4gICAgfSBlbHNlIGlmIChtZW51SXRlbS5wcm9wZXJ0aWVzPy5bJ2JsYW5rJ10pIHtcclxuICAgICAgd2luZG93Lm9wZW4obWVudUl0ZW0uaHJlZik7XHJcbiAgICB9IGVsc2UgaWYgKG1lbnVJdGVtLnByb3BlcnRpZXM/LlsnbW9kYWwnXSkge1xyXG4gICAgICB0aGlzLm9wZW5EaWFsb2cobWVudUl0ZW0pO1xyXG4gICAgfSBlbHNlIGlmIChtZW51SXRlbS5ocmVmKSB7XHJcbiAgICAgIHRoaXMubmF2aWdhdGVUbyhtZW51SXRlbS5ocmVmKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uTWVudU9wZW5lZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuaXNBY3RpdmVNZW51ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIG9uTWVudUNsb3NlZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuaXNBY3RpdmVNZW51ID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBvblN1Yk1lbnVDbG9zZWQoKTogdm9pZCB7XHJcbiAgICAvLyBpbnRlbnRpb25hbGx5IGVtcHR5LCBqdXN0IG5lZWRlZCB0byByZWZyZXNoIGhvdmVyIHN0YXRlIGluIG1lbnVcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5pc0hpZ2hsaWdodGVkTWVudSA9IHRoaXMuc2VydmljZS5hY3RpdmVNZW51SWRDaGFuZ2VzXHJcbiAgICAgICAgLnBpcGUobWFwKHZhbCA9PiB0aGlzLm5hdkl0ZW0uaWQgPT09IHZhbCkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTmF2aWdhdGUgdG8gYSBkaWZmZXJlbnQgdmlldyBpbiBFbmdhZ2UuXHJcbiAgICogTmF2aWdhdGlvbiB0YXJnZXQgYW5kIG1ldGhvZG9sb2d5IGlzIHJlc29sdmVkIGJ5IGZvbGxvd2luZyBsb2dpYzpcclxuICAgKiAxLiBJZiB0YXJnZXQgbGluayBoYXMgc2FtZSBiYXNlIGhyZWYgYXMgdGhlIGRvY3VtZW50LCBzdHJpcCBpdCBmcm9tIHRoZSBsaW5rIHRvIGhhdmUgcGF0aCBvbmx5XHJcbiAgICogMi4gSWYgdGFyZ2V0IGxpbmsgaGFkIG5vIG1hdGNoIGZvciBiYXNlIGhyZWYsIG9yIG5vIHJvdXRlciBhdmFpbGFibGUsIHNldCBsb2NhdGlvbiB0byB0YXJnZXQgbGlua1xyXG4gICAqIDMuIFRyeSB0byB1c2UgdGhlIEFuZ3VsYXIgcm91dGVyIHRvIG5hdmlnYXRlIHRvIHRoZSB1cmwgKGZyYWdtZW50KVxyXG4gICAqIDQuIElmIHJvdXRlciBuYXZpZ2F0aW9uIGZhaWxlZCwgYXNzaWduIGxvY2F0aW9uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBuYXZpZ2F0ZVRvKHVybDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnNlcnZpY2UuYWN0aXZlTmF2TWVudUlkID0gdGhpcy5uYXZJdGVtLmlkO1xyXG4gICAgY29uc3Qgcm91dGluZ1BhdGggPSB1cmwucmVwbGFjZSh0aGlzLmJhc2VIcmVmLCAnJyk7XHJcbiAgICBpZiAoL2h0dHBzPzpcXC97Mn0vLnRlc3Qocm91dGluZ1BhdGgpIHx8IHRoaXMucm91dGVyLmNvbmZpZy5sZW5ndGggPT09IDApIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih1cmwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcGFyc2VkVXJsID0gdGhpcy5yb3V0ZXIucGFyc2VVcmwocm91dGluZ1BhdGgpO1xyXG4gICAgICBjb25zdCBuYXZpZ2F0ZVJlc3VsdCA9IHRoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwocGFyc2VkVXJsLmZyYWdtZW50ID8/IHBhcnNlZFVybCk7XHJcbiAgICAgIG5hdmlnYXRlUmVzdWx0LmNhdGNoKCgpID0+IHtcclxuICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKHVybCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvcGVuRGlhbG9nKG1lbnVJdGVtOiBOYXZJdGVtKTogdm9pZCB7XHJcbiAgICBjb25zdCBjb25maWc6IE1hdERpYWxvZ0NvbmZpZyA9IHtcclxuICAgICAgd2lkdGg6ICc2MDBweCcsXHJcbiAgICAgIGhlaWdodDogJzUwMHB4JyxcclxuICAgICAgYXV0b0ZvY3VzOiBmYWxzZSxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHRpdGxlOiBtZW51SXRlbS5wcm9wZXJ0aWVzPy5bJ3RpdGxlJ10sXHJcbiAgICAgICAgc3JjVXJsOiBtZW51SXRlbS5ocmVmLFxyXG4gICAgICAgIGFkZGl0aW9uYWxDb250ZW50OiB0aGlzLnNlcnZpY2UuZ2V0U2VydmljZVZlcnNpb25JbmZvcygpXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLmRpYWxvZy5vcGVuKFRvcE5hdkRpYWxvZ0NvbXBvbmVudCwgY29uZmlnKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb3BlbkhlbHBMaW5rKHVybDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1cGRhdGVkSGVscExpbmsgPSB0aGlzLnNlcnZpY2UuZ2V0VXBkYXRlZEhlbHBMaW5rKHVybCk7XHJcbiAgICAgIHdpbmRvdy5vcGVuKHVwZGF0ZWRIZWxwTGluayk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2hlbHAgbGluayBtYWxmb3JtZWQnLCBlKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiPGRpdiAqbmdJZj1cIm5hdkl0ZW0uaWNvbiAmJiBuYXZJdGVtLmhyZWZcIlxyXG4gICAgY2xhc3M9XCJtdWktbmF2aXRlbS1pY29uXCI+XHJcbiAgPGEgW2hyZWZdPVwibmF2SXRlbS5ocmVmXCJcclxuICAgICAgW2lkXT1cIm5hdkl0ZW0uaWRcIlxyXG4gID5cclxuICAgIDxzcGFuIGNsYXNzPVwibXVpLWljb25zXCI+e3sgbmF2SXRlbS5pY29uIH19PC9zcGFuPlxyXG4gIDwvYT5cclxuPC9kaXY+XHJcblxyXG48YnV0dG9uIChtZW51Q2xvc2VkKT1cIm9uTWVudUNsb3NlZCgpXCJcclxuICAgIChtZW51T3BlbmVkKT1cIm9uTWVudU9wZW5lZCgpXCJcclxuICAgICpuZ0lmPVwibmF2SXRlbS5pY29uICYmIG5hdkl0ZW0ubWVudVwiXHJcbiAgICBbY2xhc3MuYWN0aXZlXT1cImlzQWN0aXZlTWVudSB8fCAoaXNIaWdobGlnaHRlZE1lbnUgfCBhc3luYylcIlxyXG4gICAgW21hdE1lbnVUcmlnZ2VyRm9yXT1cImxldmVsMlwiXHJcbiAgICBjbGFzcz1cIm11aS1uYXZpdGVtLWljb24tYnRuXCJcclxuICAgIG1hdC1pY29uLWJ1dHRvblxyXG4gICAgW2lkXT1cIm5hdkl0ZW0uaWRcIlxyXG4+XHJcbiAgPHNwYW4gY2xhc3M9XCJtdWktaWNvbnNcIj57eyBuYXZJdGVtLmljb24gfX08L3NwYW4+XHJcbjwvYnV0dG9uPlxyXG5cclxuPGJ1dHRvbiAobWVudUNsb3NlZCk9XCJvbk1lbnVDbG9zZWQoKVwiXHJcbiAgICAobWVudU9wZW5lZCk9XCJvbk1lbnVPcGVuZWQoKVwiXHJcbiAgICAqbmdJZj1cIm5hdkl0ZW0ubmFtZVwiXHJcbiAgICBbY2xhc3MuYWN0aXZlXT1cImlzQWN0aXZlTWVudSB8fCAoaXNIaWdobGlnaHRlZE1lbnUgfCBhc3luYylcIlxyXG4gICAgW21hdE1lbnVUcmlnZ2VyRm9yXT1cImxldmVsMlwiXHJcbiAgICBjbGFzcz1cIm11aS1uYXZpdGVtLXBhcmVudFwiXHJcbiAgICBtYXQtYnV0dG9uXHJcbiAgICBbaWRdPVwibmF2SXRlbS5pZFwiXHJcbj5cclxuICA8c3Bhbj57eyBuYXZJdGVtLm5hbWUgfX08L3NwYW4+XHJcbiAgPHNwYW4gY2xhc3M9XCJtdWktaWNvbnNcIj5jaGV2cm9uX2Rvd248L3NwYW4+XHJcbjwvYnV0dG9uPlxyXG5cclxuPG1hdC1tZW51ICNsZXZlbDI9XCJtYXRNZW51XCJcclxuICAgIGNsYXNzPVwibXVpLW5hdml0ZW0tbWVudVwiPlxyXG4gIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IG1lbnVJdGVtIG9mIG5hdkl0ZW0ubWVudVwiPlxyXG4gICAgPGEgKGNsaWNrKT1cIm9uSXRlbUNsaWNrZWQobWVudUl0ZW0sICRldmVudClcIlxyXG4gICAgICAgICpuZ0lmPVwibWVudUl0ZW0uaHJlZlwiXHJcbiAgICAgICAgY2xhc3M9XCJtdWktbmF2aXRlbS1idXR0b25cIlxyXG4gICAgICAgIG1hdC1tZW51LWl0ZW1cclxuICAgICAgICBbaWRdPVwiJzItJyArIG1lbnVJdGVtLmlkXCJcclxuICAgICAgICBbaHJlZl09XCJtZW51SXRlbS5ocmVmXCJcclxuICAgID5cclxuICAgICAgPHNwYW4gKm5nSWY9XCJtZW51SXRlbS5pY29uXCJcclxuICAgICAgICAgIGNsYXNzPVwibXVpLWljb25zXCI+e3sgbWVudUl0ZW0uaWNvbiB9fTwvc3Bhbj5cclxuICAgICAgPHNwYW4+e3sgbWVudUl0ZW0ubmFtZSB9fTwvc3Bhbj5cclxuICAgIDwvYT5cclxuICAgIDxidXR0b24gKm5nSWY9XCJtZW51SXRlbS5tZW51XCJcclxuICAgICAgICBbbWF0TWVudVRyaWdnZXJEYXRhXT1cIntpdGVtczogbWVudUl0ZW0ubWVudX1cIlxyXG4gICAgICAgIFttYXRNZW51VHJpZ2dlckZvcl09XCJsZXZlbDNcIlxyXG4gICAgICAgIGNsYXNzPVwibXVpLW5hdml0ZW0tYnV0dG9uXCJcclxuICAgICAgICBtYXQtbWVudS1pdGVtXHJcbiAgICAgICAgKG1lbnVDbG9zZWQpPVwib25TdWJNZW51Q2xvc2VkKClcIlxyXG4gICAgICAgIFtpZF09XCInMi0nICsgbWVudUl0ZW0uaWRcIlxyXG4gICAgPlxyXG4gICAgICA8c3Bhbj57eyBtZW51SXRlbS5uYW1lIH19PC9zcGFuPlxyXG4gICAgPC9idXR0b24+XHJcblxyXG4gIDwvbmctY29udGFpbmVyPlxyXG48L21hdC1tZW51PlxyXG5cclxuPG1hdC1tZW51ICNsZXZlbDM9XCJtYXRNZW51XCJcclxuICAgIGNsYXNzPVwibXVpLW5hdml0ZW0tbWVudVwiPlxyXG4gIDxuZy10ZW1wbGF0ZSBsZXQtaXRlbXM9XCJpdGVtc1wiXHJcbiAgICBtYXRNZW51Q29udGVudD5cclxuICAgIDxhIChjbGljayk9XCJvbkl0ZW1DbGlja2VkKGl0bSwgJGV2ZW50KVwiXHJcbiAgICAgICAgKm5nRm9yPVwibGV0IGl0bSBvZiBpdGVtc1wiXHJcbiAgICAgICAgY2xhc3M9XCJtdWktbmF2aXRlbS1idXR0b25cIlxyXG4gICAgICAgIG1hdC1tZW51LWl0ZW1cclxuICAgICAgICBbaWRdPVwiJzMtJyArIGl0bS5pZFwiXHJcbiAgICAgICAgW2hyZWZdPVwiaXRtLmhyZWZcIlxyXG4gICAgPnt7IGl0bS5uYW1lfX08L2E+XHJcbiAgPC9uZy10ZW1wbGF0ZT5cclxuPC9tYXQtbWVudT5cclxuXHJcbiJdfQ==