import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from '@angular/core';
import { DateTime } from 'luxon';
import { Subject } from 'rxjs';
import { filter, takeUntil } from 'rxjs/operators';
import { DISPLAY_STATES } from '../../shared/models/message';
import { messageDisplayAnimation } from '../animations';
import * as i0 from "@angular/core";
import * as i1 from "@angular/platform-browser";
import * as i2 from "../../shared/services/notification.service";
import * as i3 from "@angular/common";
import * as i4 from "@angular/material/tooltip";
export class MessageComponent {
    constructor(sanitizer, cd, ncs) {
        this.sanitizer = sanitizer;
        this.cd = cd;
        this.ncs = ncs;
        this.notificationDismiss = new EventEmitter();
        this.messageClickOptionalAction = new EventEmitter();
        this.messageDisplay = DISPLAY_STATES.collapsed;
        this.appearance = 'unify';
        this.iconClass = 'material-icons';
        this.expandIcon = 'expand_more';
        this.collapseIcon = 'expand_less';
        this.destroyed$ = new Subject();
    }
    ngOnChanges() {
        this.message = this.notification.messages[0];
        if (this.message.isExpanded) {
            this.toggleMessageViewState();
        }
        if (this.message.htmlContent && this.message.body) {
            this.message.bodyHtml = this.sanitizer.bypassSecurityTrustHtml(this.message.body);
        }
        if (this.notification.eventTime) {
            const dateTime = DateTime.fromISO(this.notification.eventTime);
            this.eventTimeRelative = dateTime.toRelative({ style: 'narrow' });
            this.eventTimeFormatted = dateTime.toFormat('f');
        }
    }
    ngOnInit() {
        this.ncs.panelOpenedChanges.pipe(takeUntil(this.destroyed$), filter(v => v === true))
            .subscribe(() => {
            this.eventTimeRelative = DateTime.fromISO(this.notification.eventTime)
                .toRelative({ style: 'short' });
            this.cd.markForCheck();
        });
        this.updateAppearance();
    }
    ngOnDestroy() {
        this.destroyed$.next();
        this.destroyed$.complete();
    }
    onDismiss(notification) {
        this.notificationDismiss.emit(notification);
    }
    toggleMessageViewState() {
        if (this.messageDisplay === DISPLAY_STATES.collapsed) {
            this.messageDisplay = DISPLAY_STATES.expanded;
        }
        else {
            this.messageDisplay = DISPLAY_STATES.collapsed;
        }
    }
    getTitle() {
        return this.message.headline;
    }
    onClickOptionalAction() {
        this.messageClickOptionalAction.emit(this.message.optionalActionLink);
    }
    updateAppearance() {
        this.appearance = this.ncs.appearance;
        if (this.appearance === 'unify') {
            this.iconClass = 'mui-icons';
            this.collapseIcon = 'chevron_down';
            this.expandIcon = 'chevron_left';
        }
        else {
            this.iconClass = 'material-icons';
            this.collapseIcon = 'expand_less';
            this.expandIcon = 'expand_more';
        }
    }
}
MessageComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: MessageComponent, deps: [{ token: i1.DomSanitizer }, { token: i0.ChangeDetectorRef }, { token: i2.NotificationService }], target: i0.ɵɵFactoryTarget.Component });
MessageComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.10", type: MessageComponent, selector: "mui-notification-message", inputs: { notification: "notification" }, outputs: { notificationDismiss: "notificationDismiss", messageClickOptionalAction: "messageClickOptionalAction" }, exportAs: ["muiNotificationMessage"], usesOnChanges: true, ngImport: i0, template: "<div class=\"{{notification.type | lowercase}}\">\r\n  <div class=\"mui-message-container\">\r\n    <div class=\"mui-title-container\">\r\n      <i class=\"{{ iconClass }} mui-message-icon {{ notification.type | lowercase }}\"\r\n          (click)=\"onDismiss(notification)\"></i>\r\n      <span class=\"mui-title\">{{getTitle()}}</span>\r\n      <span class=\"mui-expand\"\r\n          (click)=\"toggleMessageViewState()\">\r\n      <i [class]=\"iconClass\"\r\n          *ngIf=\"messageDisplay === 'collapsed'\">{{ expandIcon }}</i>\r\n      <i [class]=\"iconClass\"\r\n          *ngIf=\"messageDisplay === 'expanded'\">{{ collapseIcon }}</i>\r\n    </span>\r\n    </div>\r\n    <div class=\"mui-title-time\">{{eventTimeRelative}}</div>\r\n    <div class=\"mui-message-body\"\r\n        [@messageDisplayState]=\"messageDisplay\">\r\n      <div class=\"mui-message\">\r\n        <div *ngIf=\"!message.htmlContent\"\r\n            class=\"plaintext\">{{message.body}}</div>\r\n        <div *ngIf=\"message.htmlContent\"\r\n            class=\"htmlcontent\"\r\n            [innerHTML]=\"message.bodyHtml\"></div>\r\n      </div>\r\n      <div class=\"mui-message-image-container\"\r\n          *ngIf=\"message.imageUrl\">\r\n        <img class=\"mui-message-image\"\r\n            src=\"{{message.imageUrl}}\"/>\r\n      </div>\r\n      <div class=\"mui-message-actions\">\r\n        <div *ngIf=\"message.optionalActionLink\"\r\n            class=\"mui-message-actions-optional\"\r\n        >\r\n          <a *ngIf=\"message.optionalActionLink && notification.type === 'NEWS'\"\r\n              href=\"{{message.optionalActionLink}}\"\r\n              target=\"_blank\"\r\n              class=\"mui-btn-action\">{{message.optionalActionTitle}}</a>\r\n          <a *ngIf=\"message.optionalActionLink && notification.type !== 'NEWS'\"\r\n              class=\"mui-btn-action\"\r\n              [matTooltip]=\"message.optionalActionTitle ?? ''\"\r\n              matTooltipClass=\"mui-btn-action-tooltip\"\r\n              [matTooltipDisabled]=\"(message.optionalActionTitle?.length ?? 0) < 30\"\r\n              (click)=\"onClickOptionalAction()\">\r\n            <span>{{message.optionalActionTitle}}</span>\r\n          </a>\r\n        </div>\r\n        <div class=\"mui-message-actions-main\">\r\n          <span class=\"mui-timestamp\">{{ eventTimeFormatted }}</span>\r\n          <a *ngIf=\"notification.type !== 'NEWS'\"\r\n              class=\"mui-btn-dismiss\"\r\n              (click)=\"onDismiss(notification)\"\r\n              i18n=\"@@nc_dismiss_btn\">Dismiss</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n", styles: [".mui-message-container{margin:0;padding:16px 0 9px;overflow:hidden}.mui-title-container{display:flex;align-items:center;gap:8px;height:24px}.mui-message-actions{text-align:right;margin:8px 0 0 32px}.mui-message-actions a{cursor:pointer;display:inline-block;white-space:nowrap}.mui-message-actions .mui-btn-action{overflow:hidden;text-overflow:ellipsis;max-width:90%}.mui-message-actions-optional{margin-bottom:8px}.mui-message-actions-main{display:flex;justify-content:space-between}.mui-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}.mui-title-time{text-align:right;padding-top:4px;height:20px}.mui-message{margin:8px 0 0 32px;overflow:auto;word-wrap:break-word}.mui-message .plaintext{white-space:pre-wrap}.mui-message .htmlcontent{white-space:normal}.mui-expand{cursor:pointer;height:24px;width:24px}.mui-message-image-container{text-align:left;margin-top:16px}.mui-message-image{max-width:100%}.mui-icons.mui-message-icon.news,.material-icons.mui-message-icon.news{display:none}.news .mui-message{margin:8px 0 0;white-space:pre-wrap}.news .mui-timestamp,.news .mui-title-time{display:none}\n", ".mui-message-icon{display:inline-block;cursor:pointer;text-align:center;vertical-align:middle;flex:0}.mui-snackbar-notification-container .mui-message-icon{height:24px;width:24px;line-height:24px;cursor:default}.material-icons{vertical-align:middle;font-size:20px}\n"], dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { kind: "pipe", type: i3.LowerCasePipe, name: "lowercase" }], animations: [messageDisplayAnimation], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.10", ngImport: i0, type: MessageComponent, decorators: [{
            type: Component,
            args: [{ selector: 'mui-notification-message', exportAs: 'muiNotificationMessage', animations: [messageDisplayAnimation], changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"{{notification.type | lowercase}}\">\r\n  <div class=\"mui-message-container\">\r\n    <div class=\"mui-title-container\">\r\n      <i class=\"{{ iconClass }} mui-message-icon {{ notification.type | lowercase }}\"\r\n          (click)=\"onDismiss(notification)\"></i>\r\n      <span class=\"mui-title\">{{getTitle()}}</span>\r\n      <span class=\"mui-expand\"\r\n          (click)=\"toggleMessageViewState()\">\r\n      <i [class]=\"iconClass\"\r\n          *ngIf=\"messageDisplay === 'collapsed'\">{{ expandIcon }}</i>\r\n      <i [class]=\"iconClass\"\r\n          *ngIf=\"messageDisplay === 'expanded'\">{{ collapseIcon }}</i>\r\n    </span>\r\n    </div>\r\n    <div class=\"mui-title-time\">{{eventTimeRelative}}</div>\r\n    <div class=\"mui-message-body\"\r\n        [@messageDisplayState]=\"messageDisplay\">\r\n      <div class=\"mui-message\">\r\n        <div *ngIf=\"!message.htmlContent\"\r\n            class=\"plaintext\">{{message.body}}</div>\r\n        <div *ngIf=\"message.htmlContent\"\r\n            class=\"htmlcontent\"\r\n            [innerHTML]=\"message.bodyHtml\"></div>\r\n      </div>\r\n      <div class=\"mui-message-image-container\"\r\n          *ngIf=\"message.imageUrl\">\r\n        <img class=\"mui-message-image\"\r\n            src=\"{{message.imageUrl}}\"/>\r\n      </div>\r\n      <div class=\"mui-message-actions\">\r\n        <div *ngIf=\"message.optionalActionLink\"\r\n            class=\"mui-message-actions-optional\"\r\n        >\r\n          <a *ngIf=\"message.optionalActionLink && notification.type === 'NEWS'\"\r\n              href=\"{{message.optionalActionLink}}\"\r\n              target=\"_blank\"\r\n              class=\"mui-btn-action\">{{message.optionalActionTitle}}</a>\r\n          <a *ngIf=\"message.optionalActionLink && notification.type !== 'NEWS'\"\r\n              class=\"mui-btn-action\"\r\n              [matTooltip]=\"message.optionalActionTitle ?? ''\"\r\n              matTooltipClass=\"mui-btn-action-tooltip\"\r\n              [matTooltipDisabled]=\"(message.optionalActionTitle?.length ?? 0) < 30\"\r\n              (click)=\"onClickOptionalAction()\">\r\n            <span>{{message.optionalActionTitle}}</span>\r\n          </a>\r\n        </div>\r\n        <div class=\"mui-message-actions-main\">\r\n          <span class=\"mui-timestamp\">{{ eventTimeFormatted }}</span>\r\n          <a *ngIf=\"notification.type !== 'NEWS'\"\r\n              class=\"mui-btn-dismiss\"\r\n              (click)=\"onDismiss(notification)\"\r\n              i18n=\"@@nc_dismiss_btn\">Dismiss</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n", styles: [".mui-message-container{margin:0;padding:16px 0 9px;overflow:hidden}.mui-title-container{display:flex;align-items:center;gap:8px;height:24px}.mui-message-actions{text-align:right;margin:8px 0 0 32px}.mui-message-actions a{cursor:pointer;display:inline-block;white-space:nowrap}.mui-message-actions .mui-btn-action{overflow:hidden;text-overflow:ellipsis;max-width:90%}.mui-message-actions-optional{margin-bottom:8px}.mui-message-actions-main{display:flex;justify-content:space-between}.mui-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}.mui-title-time{text-align:right;padding-top:4px;height:20px}.mui-message{margin:8px 0 0 32px;overflow:auto;word-wrap:break-word}.mui-message .plaintext{white-space:pre-wrap}.mui-message .htmlcontent{white-space:normal}.mui-expand{cursor:pointer;height:24px;width:24px}.mui-message-image-container{text-align:left;margin-top:16px}.mui-message-image{max-width:100%}.mui-icons.mui-message-icon.news,.material-icons.mui-message-icon.news{display:none}.news .mui-message{margin:8px 0 0;white-space:pre-wrap}.news .mui-timestamp,.news .mui-title-time{display:none}\n", ".mui-message-icon{display:inline-block;cursor:pointer;text-align:center;vertical-align:middle;flex:0}.mui-snackbar-notification-container .mui-message-icon{height:24px;width:24px;line-height:24px;cursor:default}.material-icons{vertical-align:middle;font-size:20px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.DomSanitizer }, { type: i0.ChangeDetectorRef }, { type: i2.NotificationService }]; }, propDecorators: { notificationDismiss: [{
                type: Output
            }], messageClickOptionalAction: [{
                type: Output
            }], notification: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9tYXBwLXVpL25vdGlmaWNhdGlvbi1jZW50ZXIvc3JjL2xpYi9tZXNzYWdlcy9hbGVydC9tZXNzYWdlLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hcHAtdWkvbm90aWZpY2F0aW9uLWNlbnRlci9zcmMvbGliL21lc3NhZ2VzL2FsZXJ0L21lc3NhZ2UuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLHVCQUF1QixFQUFxQixTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFbkgsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUNqQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFbkQsT0FBTyxFQUFFLGNBQWMsRUFBVyxNQUFNLDZCQUE2QixDQUFDO0FBR3RFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7O0FBV3hELE1BQU0sT0FBTyxnQkFBZ0I7SUFpQjNCLFlBQ1ksU0FBdUIsRUFDckIsRUFBcUIsRUFDckIsR0FBd0I7UUFGMUIsY0FBUyxHQUFULFNBQVMsQ0FBYztRQUNyQixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFxQjtRQW5CNUIsd0JBQW1CLEdBQUcsSUFBSSxZQUFZLEVBQWdCLENBQUM7UUFDdkQsK0JBQTBCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUkxRCxtQkFBYyxHQUFXLGNBQWMsQ0FBQyxTQUFTLENBQUM7UUFJbEQsZUFBVSxHQUFpQixPQUFPLENBQUM7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LENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQztZQUM3QixJQUFJLENBQUMsWUFBWSxHQUFHLGNBQWMsQ0FBQztZQUNuQyxJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQztTQUNsQzthQUFNO1lBQ0wsSUFBSSxDQUFDLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQztZQUNsQyxJQUFJLENBQUMsWUFBWSxHQUFHLGFBQWEsQ0FBQztZQUNsQyxJQUFJLENBQUMsVUFBVSxHQUFHLGFBQWEsQ0FBQztTQUNqQztJQUNILENBQUM7OzhHQXpGVSxnQkFBZ0I7a0dBQWhCLGdCQUFnQix3UkNyQjdCLHlsRkF5REEsMnBERHZDYyxDQUFDLHVCQUF1QixDQUFDOzRGQUcxQixnQkFBZ0I7a0JBUjVCLFNBQVM7K0JBQ0UsMEJBQTBCLFlBQzFCLHdCQUF3QixjQUd0QixDQUFDLHVCQUF1QixDQUFDLG1CQUNwQix1QkFBdUIsQ0FBQyxNQUFNO3FLQUdyQyxtQkFBbUI7c0JBQTVCLE1BQU07Z0JBQ0csMEJBQTBCO3NCQUFuQyxNQUFNO2dCQUNFLFlBQVk7c0JBQXBCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuaW1wb3J0IHsgRGF0ZVRpbWUgfSBmcm9tICdsdXhvbic7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZmlsdGVyLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IE5DQXBwZWFyYW5jZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9tb2RlbHMvY29uZmlndXJhdGlvbnMnO1xyXG5pbXBvcnQgeyBESVNQTEFZX1NUQVRFUywgTWVzc2FnZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9tb2RlbHMvbWVzc2FnZSc7XHJcbmltcG9ydCB7IE5vdGlmaWNhdGlvbiB9IGZyb20gJy4uLy4uL3NoYXJlZC9tb2RlbHMvbm90aWZpY2F0aW9uJztcclxuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9ub3RpZmljYXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IG1lc3NhZ2VEaXNwbGF5QW5pbWF0aW9uIH0gZnJvbSAnLi4vYW5pbWF0aW9ucyc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtdWktbm90aWZpY2F0aW9uLW1lc3NhZ2UnLFxyXG4gIGV4cG9ydEFzOiAnbXVpTm90aWZpY2F0aW9uTWVzc2FnZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL21lc3NhZ2UuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL21lc3NhZ2UuY29tcG9uZW50LnNjc3MnLCAnLi4vaWNvbnMuY3NzJ10sXHJcbiAgYW5pbWF0aW9uczogW21lc3NhZ2VEaXNwbGF5QW5pbWF0aW9uXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgTWVzc2FnZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG4gIEBPdXRwdXQoKSBub3RpZmljYXRpb25EaXNtaXNzID0gbmV3IEV2ZW50RW1pdHRlcjxOb3RpZmljYXRpb24+KCk7XHJcbiAgQE91dHB1dCgpIG1lc3NhZ2VDbGlja09wdGlvbmFsQWN0aW9uID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBJbnB1dCgpIG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uO1xyXG5cclxuICBtZXNzYWdlOiBNZXNzYWdlOyAvLyBzaG9ydGN1dCB0byBmaXJzdCBtZXNzYWdlXHJcbiAgbWVzc2FnZURpc3BsYXk6IHN0cmluZyA9IERJU1BMQVlfU1RBVEVTLmNvbGxhcHNlZDtcclxuICBldmVudFRpbWVSZWxhdGl2ZTogc3RyaW5nIHwgbnVsbDtcclxuICBldmVudFRpbWVGb3JtYXR0ZWQ6IHN0cmluZyB8IG51bGw7XHJcblxyXG4gIGFwcGVhcmFuY2U6IE5DQXBwZWFyYW5jZSA9ICd1bmlmeSc7XHJcbiAgaWNvbkNsYXNzID0gJ21hdGVyaWFsLWljb25zJztcclxuICBleHBhbmRJY29uID0gJ2V4cGFuZF9tb3JlJztcclxuICBjb2xsYXBzZUljb24gPSAnZXhwYW5kX2xlc3MnO1xyXG5cclxuICBwcml2YXRlIGRlc3Ryb3llZCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgICAgcHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplcixcclxuICAgICAgcHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgcHJvdGVjdGVkIG5jczogTm90aWZpY2F0aW9uU2VydmljZSkge1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XHJcbiAgICB0aGlzLm1lc3NhZ2UgPSB0aGlzLm5vdGlmaWNhdGlvbi5tZXNzYWdlc1swXTtcclxuICAgIGlmICh0aGlzLm1lc3NhZ2UuaXNFeHBhbmRlZCkge1xyXG4gICAgICB0aGlzLnRvZ2dsZU1lc3NhZ2VWaWV3U3RhdGUoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLm1lc3NhZ2UuaHRtbENvbnRlbnQgJiYgdGhpcy5tZXNzYWdlLmJvZHkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmJvZHlIdG1sID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdEh0bWwodGhpcy5tZXNzYWdlLmJvZHkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLm5vdGlmaWNhdGlvbi5ldmVudFRpbWUpIHtcclxuICAgICAgY29uc3QgZGF0ZVRpbWUgPSBEYXRlVGltZS5mcm9tSVNPKHRoaXMubm90aWZpY2F0aW9uLmV2ZW50VGltZSk7XHJcbiAgICAgIHRoaXMuZXZlbnRUaW1lUmVsYXRpdmUgPSBkYXRlVGltZS50b1JlbGF0aXZlKHsgc3R5bGU6ICduYXJyb3cnIH0pO1xyXG4gICAgICB0aGlzLmV2ZW50VGltZUZvcm1hdHRlZCA9IGRhdGVUaW1lLnRvRm9ybWF0KCdmJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMubmNzLnBhbmVsT3BlbmVkQ2hhbmdlcy5waXBlKFxyXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpLFxyXG4gICAgICAgIGZpbHRlcih2ID0+IHYgPT09IHRydWUpXHJcbiAgICApXHJcbiAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmV2ZW50VGltZVJlbGF0aXZlID0gRGF0ZVRpbWUuZnJvbUlTTyh0aGlzLm5vdGlmaWNhdGlvbi5ldmVudFRpbWUpXHJcbiAgICAgICAgICAgICAgLnRvUmVsYXRpdmUoeyBzdHlsZTogJ3Nob3J0JyB9KTtcclxuICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgdGhpcy51cGRhdGVBcHBlYXJhbmNlKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGVzdHJveWVkJC5uZXh0KCk7XHJcbiAgICB0aGlzLmRlc3Ryb3llZCQuY29tcGxldGUoKTtcclxuICB9XHJcblxyXG4gIG9uRGlzbWlzcyhub3RpZmljYXRpb246IE5vdGlmaWNhdGlvbik6IHZvaWQge1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb25EaXNtaXNzLmVtaXQobm90aWZpY2F0aW9uKTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZU1lc3NhZ2VWaWV3U3RhdGUoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5tZXNzYWdlRGlzcGxheSA9PT0gRElTUExBWV9TVEFURVMuY29sbGFwc2VkKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZURpc3BsYXkgPSBESVNQTEFZX1NUQVRFUy5leHBhbmRlZDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZURpc3BsYXkgPSBESVNQTEFZX1NUQVRFUy5jb2xsYXBzZWQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRUaXRsZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMubWVzc2FnZS5oZWFkbGluZTtcclxuICB9XHJcblxyXG4gIG9uQ2xpY2tPcHRpb25hbEFjdGlvbigpOiB2b2lkIHtcclxuICAgIHRoaXMubWVzc2FnZUNsaWNrT3B0aW9uYWxBY3Rpb24uZW1pdCh0aGlzLm1lc3NhZ2Uub3B0aW9uYWxBY3Rpb25MaW5rKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCB1cGRhdGVBcHBlYXJhbmNlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5hcHBlYXJhbmNlID0gdGhpcy5uY3MuYXBwZWFyYW5jZTtcclxuICAgIGlmICh0aGlzLmFwcGVhcmFuY2UgPT09ICd1bmlmeScpIHtcclxuICAgICAgdGhpcy5pY29uQ2xhc3MgPSAnbXVpLWljb25zJztcclxuICAgICAgdGhpcy5jb2xsYXBzZUljb24gPSAnY2hldnJvbl9kb3duJztcclxuICAgICAgdGhpcy5leHBhbmRJY29uID0gJ2NoZXZyb25fbGVmdCc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmljb25DbGFzcyA9ICdtYXRlcmlhbC1pY29ucyc7XHJcbiAgICAgIHRoaXMuY29sbGFwc2VJY29uID0gJ2V4cGFuZF9sZXNzJztcclxuICAgICAgdGhpcy5leHBhbmRJY29uID0gJ2V4cGFuZF9tb3JlJztcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiPGRpdiBjbGFzcz1cInt7bm90aWZpY2F0aW9uLnR5cGUgfCBsb3dlcmNhc2V9fVwiPlxyXG4gIDxkaXYgY2xhc3M9XCJtdWktbWVzc2FnZS1jb250YWluZXJcIj5cclxuICAgIDxkaXYgY2xhc3M9XCJtdWktdGl0bGUtY29udGFpbmVyXCI+XHJcbiAgICAgIDxpIGNsYXNzPVwie3sgaWNvbkNsYXNzIH19IG11aS1tZXNzYWdlLWljb24ge3sgbm90aWZpY2F0aW9uLnR5cGUgfCBsb3dlcmNhc2UgfX1cIlxyXG4gICAgICAgICAgKGNsaWNrKT1cIm9uRGlzbWlzcyhub3RpZmljYXRpb24pXCI+PC9pPlxyXG4gICAgICA8c3BhbiBjbGFzcz1cIm11aS10aXRsZVwiPnt7Z2V0VGl0bGUoKX19PC9zcGFuPlxyXG4gICAgICA8c3BhbiBjbGFzcz1cIm11aS1leHBhbmRcIlxyXG4gICAgICAgICAgKGNsaWNrKT1cInRvZ2dsZU1lc3NhZ2VWaWV3U3RhdGUoKVwiPlxyXG4gICAgICA8aSBbY2xhc3NdPVwiaWNvbkNsYXNzXCJcclxuICAgICAgICAgICpuZ0lmPVwibWVzc2FnZURpc3BsYXkgPT09ICdjb2xsYXBzZWQnXCI+e3sgZXhwYW5kSWNvbiB9fTwvaT5cclxuICAgICAgPGkgW2NsYXNzXT1cImljb25DbGFzc1wiXHJcbiAgICAgICAgICAqbmdJZj1cIm1lc3NhZ2VEaXNwbGF5ID09PSAnZXhwYW5kZWQnXCI+e3sgY29sbGFwc2VJY29uIH19PC9pPlxyXG4gICAgPC9zcGFuPlxyXG4gICAgPC9kaXY+XHJcbiAgICA8ZGl2IGNsYXNzPVwibXVpLXRpdGxlLXRpbWVcIj57e2V2ZW50VGltZVJlbGF0aXZlfX08L2Rpdj5cclxuICAgIDxkaXYgY2xhc3M9XCJtdWktbWVzc2FnZS1ib2R5XCJcclxuICAgICAgICBbQG1lc3NhZ2VEaXNwbGF5U3RhdGVdPVwibWVzc2FnZURpc3BsYXlcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cIm11aS1tZXNzYWdlXCI+XHJcbiAgICAgICAgPGRpdiAqbmdJZj1cIiFtZXNzYWdlLmh0bWxDb250ZW50XCJcclxuICAgICAgICAgICAgY2xhc3M9XCJwbGFpbnRleHRcIj57e21lc3NhZ2UuYm9keX19PC9kaXY+XHJcbiAgICAgICAgPGRpdiAqbmdJZj1cIm1lc3NhZ2UuaHRtbENvbnRlbnRcIlxyXG4gICAgICAgICAgICBjbGFzcz1cImh0bWxjb250ZW50XCJcclxuICAgICAgICAgICAgW2lubmVySFRNTF09XCJtZXNzYWdlLmJvZHlIdG1sXCI+PC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2IGNsYXNzPVwibXVpLW1lc3NhZ2UtaW1hZ2UtY29udGFpbmVyXCJcclxuICAgICAgICAgICpuZ0lmPVwibWVzc2FnZS5pbWFnZVVybFwiPlxyXG4gICAgICAgIDxpbWcgY2xhc3M9XCJtdWktbWVzc2FnZS1pbWFnZVwiXHJcbiAgICAgICAgICAgIHNyYz1cInt7bWVzc2FnZS5pbWFnZVVybH19XCIvPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cIm11aS1tZXNzYWdlLWFjdGlvbnNcIj5cclxuICAgICAgICA8ZGl2ICpuZ0lmPVwibWVzc2FnZS5vcHRpb25hbEFjdGlvbkxpbmtcIlxyXG4gICAgICAgICAgICBjbGFzcz1cIm11aS1tZXNzYWdlLWFjdGlvbnMtb3B0aW9uYWxcIlxyXG4gICAgICAgID5cclxuICAgICAgICAgIDxhICpuZ0lmPVwibWVzc2FnZS5vcHRpb25hbEFjdGlvbkxpbmsgJiYgbm90aWZpY2F0aW9uLnR5cGUgPT09ICdORVdTJ1wiXHJcbiAgICAgICAgICAgICAgaHJlZj1cInt7bWVzc2FnZS5vcHRpb25hbEFjdGlvbkxpbmt9fVwiXHJcbiAgICAgICAgICAgICAgdGFyZ2V0PVwiX2JsYW5rXCJcclxuICAgICAgICAgICAgICBjbGFzcz1cIm11aS1idG4tYWN0aW9uXCI+e3ttZXNzYWdlLm9wdGlvbmFsQWN0aW9uVGl0bGV9fTwvYT5cclxuICAgICAgICAgIDxhICpuZ0lmPVwibWVzc2FnZS5vcHRpb25hbEFjdGlvbkxpbmsgJiYgbm90aWZpY2F0aW9uLnR5cGUgIT09ICdORVdTJ1wiXHJcbiAgICAgICAgICAgICAgY2xhc3M9XCJtdWktYnRuLWFjdGlvblwiXHJcbiAgICAgICAgICAgICAgW21hdFRvb2x0aXBdPVwibWVzc2FnZS5vcHRpb25hbEFjdGlvblRpdGxlID8/ICcnXCJcclxuICAgICAgICAgICAgICBtYXRUb29sdGlwQ2xhc3M9XCJtdWktYnRuLWFjdGlvbi10b29sdGlwXCJcclxuICAgICAgICAgICAgICBbbWF0VG9vbHRpcERpc2FibGVkXT1cIihtZXNzYWdlLm9wdGlvbmFsQWN0aW9uVGl0bGU/Lmxlbmd0aCA/PyAwKSA8IDMwXCJcclxuICAgICAgICAgICAgICAoY2xpY2spPVwib25DbGlja09wdGlvbmFsQWN0aW9uKClcIj5cclxuICAgICAgICAgICAgPHNwYW4+e3ttZXNzYWdlLm9wdGlvbmFsQWN0aW9uVGl0bGV9fTwvc3Bhbj5cclxuICAgICAgICAgIDwvYT5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwibXVpLW1lc3NhZ2UtYWN0aW9ucy1tYWluXCI+XHJcbiAgICAgICAgICA8c3BhbiBjbGFzcz1cIm11aS10aW1lc3RhbXBcIj57eyBldmVudFRpbWVGb3JtYXR0ZWQgfX08L3NwYW4+XHJcbiAgICAgICAgICA8YSAqbmdJZj1cIm5vdGlmaWNhdGlvbi50eXBlICE9PSAnTkVXUydcIlxyXG4gICAgICAgICAgICAgIGNsYXNzPVwibXVpLWJ0bi1kaXNtaXNzXCJcclxuICAgICAgICAgICAgICAoY2xpY2spPVwib25EaXNtaXNzKG5vdGlmaWNhdGlvbilcIlxyXG4gICAgICAgICAgICAgIGkxOG49XCJAQG5jX2Rpc21pc3NfYnRuXCI+RGlzbWlzczwvYT5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxuPC9kaXY+XHJcbiJdfQ==